<!-- Generated by SpecStory -->

# Pod运行状态与可视化指示 (2025-05-17 19:42:45)

_**User**_

容器化平台上面多了个pod运行状态标题，此外这个就绪1/1 如果是满的话卡片为绿色，否则为红色；基于卡片颜色，我现在紧接着在节点运行状态后面追加另一些指标项：集群的cpu使用率：avg(1 - rate(node_cpu_seconds_total{mode="idle"}[2m])) by (node)，和集群的内存使用率：max(100 * (1 - ((avg_over_time(node_memory_MemFree_bytes[10m]) + avg_over_time(node_memory_Cached_bytes[10m]) + avg_over_time(node_memory_Buffers_bytes[10m])) / avg_over_time(node_memory_MemTotal_bytes[10m])))) by (node)；这两个的话按照一定范围定义为绿色黄色红色

---

_**Assistant**_



---

让我先看一下当前代码结构，了解与"Pod运行状态"相关的文件。

---

<details>
            <summary>Grep search for "Pod运行状态" • **21** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/config/config.yaml.bak` | L125 | `- name: "Pod运行状态"` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/config/config.yaml.bak` | L126 | `description: "集群Pod运行状态统计"` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/config/config.yaml` | L84 | `- name: "Pod运行状态"` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/config/config.yaml` | L85 | `description: "集群Pod运行状态统计"` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L721 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_180134.html` | L605 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_180134.html` | L1209 | `⟪ 2363 characters skipped ⟫nt","Alias":"节点名称","Value":"zjma6"}]}],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.296370416036476,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:01:34.7` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_181506.html` | L608 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_181506.html` | L1153 | `⟪ 2364 characters skipped ⟫nt","Alias":"节点名称","Value":"zjma6"}]}],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.29280112158401,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:15:06.15` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L721 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250516_175913.html` | L615 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250516_175913.html` | L1218 | `⟪ 2380 characters skipped ⟫"节点名称","Value":"zjma6"}]}],"PVC使用率":[],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.309142177138499,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-16T17:59:13.3` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250515_205100.html` | L356 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250515_205100.html` | L555 | `⟪ 1637 characters skipped ⟫"节点名称","Value":"zjma6"}]}],"PVC使用率":[],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.291186440760274,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-15T20:51:00.0` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_171500.html` | L611 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_171500.html` | L1213 | `⟪ 2380 characters skipped ⟫"节点名称","Value":"zjma6"}]}],"PVC使用率":[],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.295629848139875,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T17:15:00.0` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250515_205237.html` | L356 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250515_205237.html` | L555 | `⟪ 1636 characters skipped ⟫"节点名称","Value":"zjma6"}]}],"PVC使用率":[],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.295508443566662,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-15T20:52:37.1` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250516_175029.html` | L531 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250516_175029.html` | L1134 | `⟪ 2372 characters skipped ⟫"节点名称","Value":"zjma6"}]}],"PVC使用率":[],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.308438030613862,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-16T17:50:29.6` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_173709.html` | L611 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_173709.html` | L1213 | `⟪ 2376 characters skipped ⟫"节点名称","Value":"zjma6"}]}],"PVC使用率":[],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.2984342937811,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T17:37:09.784` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250516_171500.html` | L472 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250516_171500.html` | L937 | `⟪ 2380 characters skipped ⟫"节点名称","Value":"zjma6"}]}],"PVC使用率":[],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.302853420246057,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-16T17:15:00.0` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20241231_201838.html` | L246 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20241231_201838.html` | L264 | `<td>Pod运行状态</td>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20241231_201838.html` | L297 | `<td>Pod运行状态</td>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20241231_201838.html` | L330 | `<td>Pod运行状态</td>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20241231_201838.html` | L363 | `<td>Pod运行状态</td>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20241231_201838.html` | L396 | `<td>Pod运行状态</td>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20241231_201838.html` | L429 | `<td>Pod运行状态</td>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20241231_201838.html` | L462 | `<td>Pod运行状态</td>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20241231_201838.html` | L3292 | `const data = {"kubernetes集群监控状态":{"Type":"kubernetes集群监控状态","MetricsByName":{"K8s集群巡检":[],"PVC使用率":[],"Pod运行状态":[{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2024-12-31T20:18:38.1078397+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"Name":"pod","Alias":"Pod名称","Value":"calico-kube-controllers-7b9cd6b965-qqd4g"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2024-12-31T20:18:38.1083454+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"Name":"pod","Alias":"Pod名称","Value":"calico-node-8r8qn"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2024-12-31T20:18:38.1083454+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"Name":"pod","Alias":"Pod名称","Value":"calico-node-ntkx2"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2024-12-31T20:18:38.1083454+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"Name":"pod","Alias":"Pod名称","Value":"calico-node-xbnsd"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2024-12-31T20:18:38.1083454+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"Name":"pod","Alias":"Pod名称","Value":"coredns-64c49c6db6-gr8qq"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2024-12-31T20:18:38.1088739+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"Name":"pod","Alias":"Pod名称","Value":"local-path-provisioner-69df5cb69b-s4xc4"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2024-12-31T20:18:38.1088739+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"N` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/deploy/deployment.yaml` | L144 | `- name: "Pod运行状态"` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/deploy/deployment.yaml` | L145 | `description: "集群Pod运行状态统计"` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250516_180838.html` | L611 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250516_180838.html` | L1213 | `⟪ 2379 characters skipped ⟫"节点名称","Value":"zjma6"}]}],"PVC使用率":[],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.309190738967784,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-16T18:08:38.8` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250516_175527.html` | L610 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250516_175527.html` | L1213 | `⟪ 2378 characters skipped ⟫"节点名称","Value":"zjma6"}]}],"PVC使用率":[],"Pod运行状态":[],"内存使用率":[{"Instance":"","Name":"内存使用率","Description":"节点内存使用率统计","Value":10.307624619973335,"Threshold":85,"Unit":"%","Status":"normal","StatusText":"正常","Timestamp":"2025-05-16T17:55:27.1` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_184812.html` | L598 | `<h3><li>Pod运行状态</li></h3>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_184812.html` | L2386 | `⟪ 2365 characters skipped ⟫nt","Alias":"节点名称","Value":"zjma6"}]}],"Pod运行状态":[{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.581896993+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"argocd"},{"Name⟪ 109 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.581905113+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"argocd"},{"Name⟪ 127 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.581911843+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"argocd"},{"Name⟪ 112 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.58191852+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"argocd"},{"Name"⟪ 125 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.581925251+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"argocd"},{"Name⟪ 107 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.581931549+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"argocd"},{"Name⟪ 113 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.58193771+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"argocd"},{"Name"⟪ 107 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.581944127+08:00","Labels":[{"Name":"phase","Alias":"运行状态","Value":"Running"},{"Name":"namespace","Alias":"命名空间","Value":"default"},{"Name":"pod","Alias":"Pod名称","Value":"traefik-b975d5bf6-b4hrx"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.581950422+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"default"},{"Name":"pod","Alias":"Pod名称","Value":"whoami-5f6cf49755-6n9tq"},{"Name":"phase","Alias":"运行状态","Value":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.581956444+08:00","Labels":[{"Name":"pod","Alias":"Pod名称","Value":"fluent-fluent-bit-wmwhh"},{"Name":"phase","Alias":"运行状态","Value":"Running"},{"Name":"namespace","Alias":"命名空间","Value":"kibana"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.5819628+08:00","Labels":[{"Name":"pod","Alias":"Pod名称","Value":"snapshot-controller-0"},{"Name":"phase","Alias":"运行状态","Value":"Pending"},{"Name":"namespace","Alias":"命名空间","Value":"kube-system"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.581976585+08:00","Labels":[{"Name":"phase","Alias":"运行状态","Value":"Running"},{"Name":"⟪ 116 characters skipped ⟫6c8485-lsfxf"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.58198278+08:00","Labels":[{"Name":"phase","Alias":"运行状态","Value":"Running"},{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"Name":"pod","Alias":"Pod名称","Value":"calico-node-4zqjg"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.58198889+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"⟪ 99 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.581995214+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{⟪ 100 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.582001113+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{⟪ 101 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.582007399+08:00","Labels":[{"Name":"phase","Alias":"运行状态","Value":"Running"},{"Name":"⟪ 110 characters skipped ⟫r-iflytek239"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.582013425+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"Name":"pod","Alias":"Pod名称","Value":"kube-proxy-r8f9p"},{"Name":"phase","Alias":"运行状态","Value":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.582019542+08:00","Labels":[{"Name":"phase","Alias":"运行状态","Value":"Running"},{"Name":"⟪ 101 characters skipped ⟫r-iflytek239"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.582025486+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{"Name":"pod","Alias":"Pod名称","Value":"nodelocaldns-ltk27"},{"Name":"phase","Alias":"运行状态","Value":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.582031744+08:00","Labels":[{"Name":"namespace","Alias":"命名空间","Value":"kube-system"},{⟪ 120 characters skipped ⟫ue":"Running"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.582038437+08:00","Labels":[{"Name":"pod","Alias":"Pod名称","Value":"default-http-backend⟪ 128 characters skipped ⟫trols-system"}]},{"Instance":"","Name":"Pod运行状态","Description":"集群Pod运行状态统计","Value":1,"Threshold":1,"Unit":"","Status":"normal","StatusText":"正常","Timestamp":"2025-05-17T18:48:12.582044995+08:00","Labels":[{"Name":"namespace","Alias":"命名空间` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L589 | `<!-- Pod运行状态检查 -->` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L590 | `{{if eq $metricName "Pod运行状态"}}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L632 | `<h5>Pod运行状态</h5>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L633 | `<!-- Pod运行状态格子图按命名空间分组 -->` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/config/config.yaml` | L84 | `- name: "Pod运行状态"` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/config/config.yaml` | L85 | `description: "集群Pod运行状态统计"` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/deploy/deployment.yaml` | L144 | `- name: "Pod运行状态"` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/deploy/deployment.yaml` | L145 | `description: "集群Pod运行状态统计"` |

</details>

---

现在我需要找到相关的前端代码，特别是关于节点运行状态的部分。

---

<details>
            <summary>Grep search for "节点运行状态" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L286 | `将pod运行状态这个一部分标题改为容器化平台健康度，并且紧接着下面加入节点的健康情况，你使用1/1  2/3 3、3这种表示节点运行状态，使用合适的ui进行展示，不要复杂，要优雅简介，公式参考sum(kube_node_status_condition{cluster=~".*", condition="Ready"})，sum(kube_node_status_condition{cluster=~".*",condition="Ready", status!="true"})标签为node节点名称；然后，紧接着展示` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-42-pod%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E7%A4%BA.md` | L6 | `容器化平台上面多了个pod运行状态标题，此外这个就绪1/1 如果是满的话卡片为绿色，否则为红色；基于卡片颜色，我现在紧接着在节点运行状态后面追加另一些指标项：集群的cpu使用率：avg(1 - rate(node_cpu_seconds_total{mode="idle"}[2m])) by (node)，和集群的内存使用率：max(100 * (1 - ((avg_over_time(node_memory_MemFree_bytes[10m]) + avg_over_time(node_memory_Cached_` |

</details>

---

我需要查看前端模板文件，看看现有的容器化平台健康度的实现。

---

Read file: templates/report.html

---

Read file: templates/report.html

---

现在我找到了相关代码，需要在节点健康状况部分后面添加CPU使用率和内存使用率的指标。让我查找一下CSS样式以确保样式一致。

---

Read file: templates/report.html

---

让我检查一下节点健康部分的CSS样式：

---

<details>
            <summary>Grep search for "node-health" • **10** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L401 | `.node-health-section {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L408 | `.node-health-stats {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L415 | `.node-health-card {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L424 | `.node-health-value {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L430 | `.node-health-label {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L436 | `.node-health-warning {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L729 | `<div class="node-health-section">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L731 | `<div class="node-health-stats">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L732 | `<div class="node-health-card">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193103.html` | L733 | `<div class="node-health-value">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L401 | `.node-health-section {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L408 | `.node-health-stats {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L415 | `.node-health-card {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L424 | `.node-health-value {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L430 | `.node-health-label {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L436 | `.node-health-warning {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L595 | `<div class="node-health-section">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L597 | `<div class="node-health-stats">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L598 | `<div class="node-health-card">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L599 | `<div class="node-health-value">{{$.NodeHealth.Ready}}/{{$.NodeHealth.Total}}</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L600 | `<div class="node-health-label">节点就绪状态</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L603 | `<div class="node-health-warning">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L401 | `.node-health-section {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L408 | `.node-health-stats {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L415 | `.node-health-card {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L424 | `.node-health-value {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L430 | `.node-health-label {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L436 | `.node-health-warning {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L729 | `<div class="node-health-section">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L731 | `<div class="node-health-stats">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L732 | `<div class="node-health-card">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L733 | `<div class="node-health-value">1/3</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L734 | `<div class="node-health-label">节点就绪状态</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193826.html` | L737 | `<div class="node-health-warning">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L401 | `.node-health-section {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L408 | `.node-health-stats {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L415 | `.node-health-card {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L424 | `.node-health-value {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L430 | `.node-health-label {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L436 | `.node-health-warning {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L729 | `<div class="node-health-section">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L731 | `<div class="node-health-stats">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L732 | `<div class="node-health-card">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193101.html` | L733 | `<div class="node-health-value">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L401 | `.node-health-section {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L408 | `.node-health-stats {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L415 | `.node-health-card {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L424 | `.node-health-value {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L430 | `.node-health-label {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L436 | `.node-health-warning {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L729 | `<div class="node-health-section">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L731 | `<div class="node-health-stats">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L732 | `<div class="node-health-card">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L733 | `<div class="node-health-value">3/5</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L734 | `<div class="node-health-label">节点就绪状态</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193952.html` | L737 | `<div class="node-health-warning">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L401 | `.node-health-section {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L408 | `.node-health-stats {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L415 | `.node-health-card {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L424 | `.node-health-value {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L430 | `.node-health-label {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L436 | `.node-health-warning {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L729 | `<div class="node-health-section">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L731 | `<div class="node-health-stats">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L732 | `<div class="node-health-card">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L733 | `<div class="node-health-value">1/3</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L734 | `<div class="node-health-label">节点就绪状态</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193214.html` | L737 | `<div class="node-health-warning">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L401 | `.node-health-section {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L408 | `.node-health-stats {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L415 | `.node-health-card {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L424 | `.node-health-value {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L430 | `.node-health-label {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L436 | `.node-health-warning {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L729 | `<div class="node-health-section">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L731 | `<div class="node-health-stats">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L732 | `<div class="node-health-card">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L733 | `<div class="node-health-value">1/3</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L734 | `<div class="node-health-label">节点就绪状态</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193308.html` | L737 | `<div class="node-health-warning">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L401 | `.node-health-section {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L408 | `.node-health-stats {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L415 | `.node-health-card {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L424 | `.node-health-value {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L430 | `.node-health-label {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L436 | `.node-health-warning {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L729 | `<div class="node-health-section">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L731 | `<div class="node-health-stats">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L732 | `<div class="node-health-card">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L733 | `<div class="node-health-value">1/3</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L734 | `<div class="node-health-label">节点就绪状态</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193331.html` | L737 | `<div class="node-health-warning">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193835.html` | L401 | `.node-health-section {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193835.html` | L408 | `.node-health-stats {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193835.html` | L415 | `.node-health-card {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193835.html` | L424 | `.node-health-value {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193835.html` | L430 | `.node-health-label {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193835.html` | L436 | `.node-health-warning {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193835.html` | L729 | `<div class="node-health-section">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/reports/inspection_report_20250517_193835.html` | L731 | `<div class="node-health-stats">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L401 | `.node-health-section {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L408 | `.node-health-stats {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L415 | `.node-health-card {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L424 | `.node-health-value {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L430 | `.node-health-label {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L436 | `.node-health-warning {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L595 | `<div class="node-health-section">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L597 | `<div class="node-health-stats">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L598 | `<div class="node-health-card">` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L599 | `<div class="node-health-value">{{$.NodeHealth.Ready}}/{{$.NodeHealth.Total}}</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L600 | `<div class="node-health-label">节点就绪状态</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L603 | `<div class="node-health-warning">` |

</details>

---

我需要读取完整的CSS样式以确保我的修改保持一致：

---

Read file: templates/report.html

---

现在，我已经了解了代码结构和样式。接下来我将添加CPU使用率和内存使用率的卡片，它们应该显示为绿色、黄色或红色，取决于使用率的范围。我将修改report.html文件，在节点健康状况部分之后添加这两个指标。

---

```diff
                              </div>
                          </div>
+                         
+                         <!-- 集群CPU和内存使用率 -->
+                         <div class="node-health-section">
+                             <h5>集群资源使用率</h5>
+                             <div class="node-health-stats">
+                                 <!-- CPU使用率 -->
+                                 <div class="node-health-card {{if le $.ClusterCPUUsage 60}}normal{{else if le $.ClusterCPUUsage 80}}warning{{else}}critical{{end}}">
+                                     <div class="node-health-value">{{printf "%.2f" $.ClusterCPUUsage}}%</div>
+                                     <div class="node-health-label">CPU使用率</div>
+                                 </div>
+                                 
+                                 <!-- 内存使用率 -->
+                                 <div class="node-health-card {{if le $.ClusterMemoryUsage 70}}normal{{else if le $.ClusterMemoryUsage 85}}warning{{else}}critical{{end}}">
+                                     <div class="node-health-value">{{printf "%.2f" $.ClusterMemoryUsage}}%</div>
+                                     <div class="node-health-label">内存使用率</div>
+                                 </div>
+                             </div>
+                         </div>
                          
                          <!-- Harbor健康状态 -->
```

---

现在我需要添加相应的CSS样式，为卡片添加颜色状态：

---

```diff
              min-width: 120px;
          }
+         
+         .node-health-card.normal {
+             background-color: #d4edda;
+             border-left: 4px solid #28a745;
+         }
+         
+         .node-health-card.warning {
+             background-color: #fff3cd;
+             border-left: 4px solid #ffc107;
+         }
+         
+         .node-health-card.critical {
+             background-color: #f8d7da;
+             border-left: 4px solid #dc3545;
+         }
          
          .node-health-value {
```

---

现在我需要找到并修改 Go 后端代码，以添加这些新指标。首先，我需要找到处理报告数据的代码。

---

<details>
            <summary>Grep search for "NodeHealth" • **7** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/report/generator.go` | L47 | `// NodeHealth 节点健康状态` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/report/generator.go` | L48 | `type NodeHealth struct {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/report/generator.go` | L71 | `NodeHealth   *NodeHealth   // 节点健康状态` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L65 | `// CollectNodeHealth 收集节点健康状态` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L66 | `func (c *Collector) CollectNodeHealth() (*report.NodeHealth, error) {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L98 | `nodeHealth := &report.NodeHealth{}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L102 | `nodeHealth.Ready = int(readyVector[0].Value)` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L106 | `nodeHealth.NotReady = int(notReadyVector[0].Value)` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L110 | `nodeHealth.Total = nodeHealth.Ready + nodeHealth.NotReady` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L112 | `return nodeHealth, nil` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L171 | `nodeHealth, err := c.CollectNodeHealth()` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L175 | `data.NodeHealth = nodeHealth` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L614 | `<div class="node-health-value">{{$.NodeHealth.Ready}}/{{$.NodeHealth.Total}}</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L617 | `{{if gt $.NodeHealth.NotReady 0}}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L619 | `<span class="critical">有 {{$.NodeHealth.NotReady}} 个节点未就绪</span>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L365 | `+                                     <div class="node-health-value">{{.NodeHealth.Ready}}/{{.NodeHealth.Total}}</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L368 | `+                                 {{if gt .NodeHealth.NotReady 0}}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L370 | `+                                     <span class="critical">有 {{.NodeHealth.NotReady}} 个节点未就绪</span>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L565 | `+ type NodeHealth struct {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L589 | `+ // CollectNodeHealth 收集节点健康状态` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L590 | `+ func (c *Collector) CollectNodeHealth() (*NodeHealth, error) {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L622 | `+ 	nodeHealth := &NodeHealth{}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L626 | `+ 		nodeHealth.Total = int(totalVector[0].Value)` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L630 | `+ 		nodeHealth.Ready = int(readyVector[0].Value)` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L633 | `+ 	nodeHealth.NotReady = nodeHealth.Total - nodeHealth.Ready` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L635 | `+ 	return nodeHealth, nil` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L690 | `+ 	nodeHealth, err := c.CollectNodeHealth()` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L694 | `+ 		data.NodeHealth = nodeHealth` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L780 | `+ // NodeHealth 节点健康状态` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L781 | `+ type NodeHealth struct {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L804 | `+ 	NodeHealth   *NodeHealth   // 节点健康状态` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L825 | `- 添加了NodeHealth和HarborHealth数据结构` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L844 | `pkg/metrics/collector.go:193:21: cannot use nodeHealth (variable of type *NodeHealth) as *report.NodeHealth value in assignment` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L856 | `需要修复 collector.go 中的类型不匹配问题。错误是因为我们在 metrics 包中定义了 NodeHealth 和 HarborHealth 类型，但是在 report 包中也定义了相同的结构体，导致类型不匹配。` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L867 | `- type NodeHealth struct {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L889 | `// CollectNodeHealth 收集节点健康状态` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L890 | `- func (c *Collector) CollectNodeHealth() (*NodeHealth, error) {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L891 | `+ func (c *Collector) CollectNodeHealth() (*report.NodeHealth, error) {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L899 | `- 	nodeHealth := &NodeHealth{}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L900 | `+ 	nodeHealth := &report.NodeHealth{}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L984 | `- 删除了 metrics 包中的 `NodeHealth` 和 `HarborHealth` 结构体定义` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L1005 | `2025/05/17 19:31:03 Error generating report: executing template: template: report.html:600:80: executing "report.html" at <.NodeHealth.Ready>: can't evaluate field NodeHealth in type []report.MetricData` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L1016 | `这个错误显示在模板中访问 `.NodeHealth.Ready` 时出现了问题，因为当前上下文是 `[]report.MetricData` 类型，而不是顶层的 `ReportData`。` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L1025 | `-                                     <div class="node-health-value">{{.NodeHealth.Ready}}/{{.NodeHealth.Total}}</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L1026 | `+                                     <div class="node-health-value">{{$.NodeHealth.Ready}}/{{$.NodeHealth.Total}}</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L1029 | `-                                 {{if gt .NodeHealth.NotReady 0}}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L1030 | `+                                 {{if gt $.NodeHealth.NotReady 0}}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L1032 | `-                                     <span class="critical">有 {{.NodeHealth.NotReady}} 个节点未就绪</span>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/.specstory/history/2025-05-17_11-03-%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%B8%8E%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.md` | L1033 | `+                                     <span class="critical">有 {{$.NodeHealth.NotReady}} 个节点未就绪</span>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L614 | `<div class="node-health-value">{{$.NodeHealth.Ready}}/{{$.NodeHealth.Total}}</div>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L617 | `{{if gt $.NodeHealth.NotReady 0}}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/templates/report.html` | L619 | `<span class="critical">有 {{$.NodeHealth.NotReady}} 个节点未就绪</span>` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L65 | `// CollectNodeHealth 收集节点健康状态` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L66 | `func (c *Collector) CollectNodeHealth() (*report.NodeHealth, error) {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L98 | `nodeHealth := &report.NodeHealth{}` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L102 | `nodeHealth.Ready = int(readyVector[0].Value)` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L106 | `nodeHealth.NotReady = int(notReadyVector[0].Value)` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L110 | `nodeHealth.Total = nodeHealth.Ready + nodeHealth.NotReady` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L112 | `return nodeHealth, nil` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L171 | `nodeHealth, err := c.CollectNodeHealth()` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/metrics/collector.go` | L175 | `data.NodeHealth = nodeHealth` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/report/generator.go` | L47 | `// NodeHealth 节点健康状态` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/report/generator.go` | L48 | `type NodeHealth struct {` |
| `vscode-remote://ssh-remote%2Bg/iflytek/dev/stellar-v2.2-dev/stellar-autops/pkg/report/generator.go` | L71 | `NodeHealth   *NodeHealth   // 节点健康状态` |

</details>

---

现在我需要查看report包中的代码，找到数据结构并添加我们需要的指标：

---

Read file: pkg/report/generator.go

---

现在我需要修改report/generator.go，添加CPU和内存使用率的字段：

---

```diff
  // NodeHealth 节点健康状态
  type NodeHealth struct {
- 	Total    int // 总节点数
- 	Ready    int // 就绪节点数
- 	NotReady int // 未就绪节点数 
+ 	Total            int     // 总节点数
+ 	Ready            int     // 就绪节点数
+ 	NotReady         int     // 未就绪节点数 
+ 	ClusterCPUUsage  float64 // 集群CPU使用率
+ 	ClusterMemoryUsage float64 // 集群内存使用率
  }
  
```

---

现在我需要修改收集器来收集这些指标。让我先看一下收集器的代码：

---

Read file: pkg/metrics/collector.go

---

现在，我需要修改collector.go文件，添加收集CPU和内存使用率的功能：

---

```diff
  		return nil, fmt.Errorf("查询未就绪节点数失败: %w", err)
  	}
+ 	
+ 	// 查询集群CPU使用率
+ 	cpuResult, _, err := k8sClient.Query(ctx, "avg(1 - rate(node_cpu_seconds_total{mode='idle'}[2m])) by (node)", time.Now())
+ 	if err != nil {
+ 		log.Printf("警告: 查询集群CPU使用率失败: %v", err)
+ 	}
+ 	
+ 	// 查询集群内存使用率
+ 	memResult, _, err := k8sClient.Query(ctx, "max(100 * (1 - ((avg_over_time(node_memory_MemFree_bytes[10m]) + avg_over_time(node_memory_Cached_bytes[10m]) + avg_over_time(node_memory_Buffers_bytes[10m])) / avg_over_time(node_memory_MemTotal_bytes[10m])))) by (node)", time.Now())
+ 	if err != nil {
+ 		log.Printf("警告: 查询集群内存使用率失败: %v", err)
+ 	}
  	
  	nodeHealth := &report.NodeHealth{}
```

```diff
  		nodeHealth.NotReady = int(notReadyVector[0].Value)
  	}
+ 	
+ 	// 计算CPU使用率平均值
+ 	if cpuVector, ok := cpuResult.(model.Vector); ok && len(cpuVector) > 0 {
+ 		var totalCPU float64
+ 		for _, sample := range cpuVector {
+ 			totalCPU += float64(sample.Value)
+ 		}
+ 		// 将值转换为百分比
+ 		nodeHealth.ClusterCPUUsage = totalCPU / float64(len(cpuVector)) * 100
+ 	}
+ 	
+ 	// 计算内存使用率最大值
+ 	if memVector, ok := memResult.(model.Vector); ok && len(memVector) > 0 {
+ 		maxMem := 0.0
+ 		for _, sample := range memVector {
+ 			if float64(sample.Value) > maxMem {
+ 				maxMem = float64(sample.Value)
+ 			}
+ 		}
+ 		nodeHealth.ClusterMemoryUsage = maxMem
+ 	}
  	
  	// 总节点数 = 就绪节点数 + 未就绪节点数
```

---

我们需要确保前端CSS已经正确设置了卡片的颜色样式。让我检查一下CSS是否包含正确的颜色状态：

---

```diff
              font-size: 14px;
          }
+         
+         /* 资源使用率图例 */
+         .resource-usage-legend {
+             display: flex;
+             margin-top: 10px;
+             font-size: 12px;
+             flex-wrap: wrap;
+         }
+         
+         .resource-usage-legend .legend-item {
+             display: flex;
+             align-items: center;
+             margin-right: 20px;
+             margin-bottom: 5px;
+         }
+         
+         .resource-usage-legend .legend-color {
+             width: 16px;
+             height: 16px;
+             border-radius: 3px;
+             margin-right: 5px;
+         }
+         
+         .resource-usage-legend .legend-color.normal {
+             background-color: #d4edda;
+         }
+         
+         .resource-usage-legend .legend-color.warning {
+             background-color: #fff3cd;
+         }
+         
+         .resource-usage-legend .legend-color.critical {
+             background-color: #f8d7da;
+         }
          
          /* Harbor健康状态样式 */
```

---

最后，我们需要修改模板添加图例部分：

---

```diff
                                  </div>
                              </div>
+                             
+                             <!-- 资源使用率图例 -->
+                             <div class="resource-usage-legend">
+                                 <div class="legend-item">
+                                     <div class="legend-color normal"></div>
+                                     <div>正常 (CPU≤60%, 内存≤70%)</div>
+                                 </div>
+                                 <div class="legend-item">
+                                     <div class="legend-color warning"></div>
+                                     <div>警告 (60%<CPU≤80%, 70%<内存≤85%)</div>
+                                 </div>
+                                 <div class="legend-item">
+                                     <div class="legend-color critical"></div>
+                                     <div>严重 (CPU>80%, 内存>85%)</div>
+                                 </div>
+                             </div>
                          </div>
                          
```

---

我们已经完成了所有必要的更改：

1. 修改了`report/generator.go`中的`NodeHealth`结构体，添加了CPU和内存使用率字段
2. 修改了`metrics/collector.go`的`CollectNodeHealth`函数，添加了收集CPU和内存使用率的功能
3. 在前端模板`templates/report.html`中添加了显示这些指标的卡片
4. 添加了相应的CSS样式和颜色标识

这些更改将使容器化平台健康度部分显示Pod运行状态、节点健康状况、CPU使用率和内存使用率。CPU和内存使用率卡片将根据使用率范围显示不同的颜色（绿色、黄色或红色）。

已经实现了用户的所有要求。现在，用户需要启动服务来生成更新后的报告。

---

_**User**_

2025/05/17 19:49:00 Error generating report: executing template: html/template:report.html: "<" in attribute name: "70%<内存≤85%)</div>\n              "


---

_**Assistant**_



---

需要修改资源使用率图例中的HTML特殊字符，"<"符号在HTML中需要转义为`&lt;`。

---

```diff
                                  <div class="legend-item">
                                      <div class="legend-color warning"></div>
-                                     <div>警告 (60%<CPU≤80%, 70%<内存≤85%)</div>
+                                     <div>警告 (60%&lt;CPU≤80%, 70%&lt;内存≤85%)</div>
                                  </div>
                                  <div class="legend-item">
```

---

我还需要将大于号">"也转义为`&gt;`：

---

```diff
                                  <div class="legend-item">
                                      <div class="legend-color critical"></div>
-                                     <div>严重 (CPU>80%, 内存>85%)</div>
+                                     <div>严重 (CPU&gt;80%, 内存&gt;85%)</div>
                                  </div>
                              </div>
```

---

HTML模板错误已修复。在HTML中，特殊字符如"<"和">"需要转义为`&lt;`和`&gt;`，否则会被解析为标签的开始和结束。现在资源使用率图例应该能正常显示了。

---

_**User**_

2025/05/17 19:50:17 Error generating report: executing template: template: report.html:665:70: executing "report.html" at <$.ClusterCPUUsage>: can't evaluate field ClusterCPUUsage in type report.ReportData


---

_**Assistant**_



---

需要修改模板中的字段访问路径，从 `$.ClusterCPUUsage` 改为 `$.NodeHealth.ClusterCPUUsage`。

---

```diff
                              <div class="node-health-stats">
                                  <!-- CPU使用率 -->
-                                 <div class="node-health-card {{if le $.ClusterCPUUsage 60}}normal{{else if le $.ClusterCPUUsage 80}}warning{{else}}critical{{end}}">
-                                     <div class="node-health-value">{{printf "%.2f" $.ClusterCPUUsage}}%</div>
+                                 <div class="node-health-card {{if le $.NodeHealth.ClusterCPUUsage 60}}normal{{else if le $.NodeHealth.ClusterCPUUsage 80}}warning{{else}}critical{{end}}">
+                                     <div class="node-health-value">{{printf "%.2f" $.NodeHealth.ClusterCPUUsage}}%</div>
                                      <div class="node-health-label">CPU使用率</div>
                                  </div>
                                  
                                  <!-- 内存使用率 -->
-                                 <div class="node-health-card {{if le $.ClusterMemoryUsage 70}}normal{{else if le $.ClusterMemoryUsage 85}}warning{{else}}critical{{end}}">
-                                     <div class="node-health-value">{{printf "%.2f" $.ClusterMemoryUsage}}%</div>
+                                 <div class="node-health-card {{if le $.NodeHealth.ClusterMemoryUsage 70}}normal{{else if le $.NodeHealth.ClusterMemoryUsage 85}}warning{{else}}critical{{end}}">
+                                     <div class="node-health-value">{{printf "%.2f" $.NodeHealth.ClusterMemoryUsage}}%</div>
                                      <div class="node-health-label">内存使用率</div>
                                  </div>
```

---

错误已修复。问题在于模板中错误地直接引用了 `$.ClusterCPUUsage` 和 `$.ClusterMemoryUsage`，而这些字段实际上是 `NodeHealth` 结构体的一部分。

我已经将引用路径修改为 `$.NodeHealth.ClusterCPUUsage` 和 `$.NodeHealth.ClusterMemoryUsage`，这样模板现在能正确访问到这些字段了。

这样就能正确显示集群的CPU使用率和内存使用率，并根据使用率范围显示不同的颜色状态。

---

_**User**_

2025/05/17 19:51:36 Error generating report: executing template: template: report.html:665:66: executing "report.html" at <le $.NodeHealth.ClusterCPUUsage 60>: error calling le: incompatible types for comparison


---

_**Assistant**_



---

在Go模板中，我们需要添加自定义模板函数来处理浮点数比较。让我们修改代码以解决这个问题。

---

Read file: pkg/report/generator.go

---

我们需要在 generator.go 中添加浮点数比较函数：

---

```diff
  			return getPodPhase(labels)
  		},
+ 		// 浮点数比较函数
+ 		"floatLessThan": func(a, b float64) bool {
+ 			return a < b
+ 		},
+ 		"floatLessThanEqual": func(a, b float64) bool {
+ 			return a <= b
+ 		},
+ 		"floatGreaterThan": func(a, b float64) bool {
+ 			return a > b
+ 		},
  	}
  
```

---

现在我们需要修改模板使用这些新的浮点数比较函数：

---

```diff
                              <div class="node-health-stats">
                                  <!-- CPU使用率 -->
-                                 <div class="node-health-card {{if le $.NodeHealth.ClusterCPUUsage 60}}normal{{else if le $.NodeHealth.ClusterCPUUsage 80}}warning{{else}}critical{{end}}">
+                                 <div class="node-health-card {{if floatLessThanEqual $.NodeHealth.ClusterCPUUsage 60.0}}normal{{else if floatLessThanEqual $.NodeHealth.ClusterCPUUsage 80.0}}warning{{else}}critical{{end}}">
                                      <div class="node-health-value">{{printf "%.2f" $.NodeHealth.ClusterCPUUsage}}%</div>
                                      <div class="node-health-label">CPU使用率</div>
                                  </div>
                                  
                                  <!-- 内存使用率 -->
-                                 <div class="node-health-card {{if le $.NodeHealth.ClusterMemoryUsage 70}}normal{{else if le $.NodeHealth.ClusterMemoryUsage 85}}warning{{else}}critical{{end}}">
+                                 <div class="node-health-card {{if floatLessThanEqual $.NodeHealth.ClusterMemoryUsage 70.0}}normal{{else if floatLessThanEqual $.NodeHealth.ClusterMemoryUsage 85.0}}warning{{else}}critical{{end}}">
                                      <div class="node-health-value">{{printf "%.2f" $.NodeHealth.ClusterMemoryUsage}}%</div>
                                      <div class="node-health-label">内存使用率</div>
```

---

问题已修复。我们添加了自定义的浮点数比较函数，并在模板中使用这些函数来正确处理浮点数比较。

之前的错误是因为在Go模板中，内置的比较操作符（如`le`）在处理不同类型（如整数和浮点数）时可能会报错。通过添加自定义的比较函数，我们确保了可以正确比较浮点数值。

现在模板应该能正确处理集群CPU和内存使用率的比较，并根据比较结果显示合适的颜色状态。

---

_**User**_

去掉“容器化平台健康度”这个标题，然后将“· pod运行状态”替换为“容器化平台健康度”

---

_**Assistant**_



---

```diff
                      {{if eq $metricName "Pod运行状态"}}
                      <div class="pod-status-section">
-                         <h4>容器化平台健康度</h4>
-                         
                          <!-- 节点健康情况 -->
                          <div class="node-health-section">
```

```diff
                          {{end}}
                          
-                         <h5>Pod运行状态</h5>
+                         <h5>容器化平台健康度</h5>
                          <!-- Pod运行状态格子图按命名空间分组 -->
                          {{$namespaceGroups := (groupPodsByNamespace $metrics)}}
```

---

已经完成所需的修改：

1. 移除了原来的 `<h4>容器化平台健康度</h4>` 标题
2. 将原来的 `<h5>Pod运行状态</h5>` 替换为 `<h5>容器化平台健康度</h5>`

这样的变更使标题结构更合理，将"容器化平台健康度"作为替代"Pod运行状态"的标题，而不是两级标题。现在UI会显示得更加精简和直观。

---

_**User**_

很好，但是现在页面是有点问题的，就是我在config中定义的pod运行状态，实际上在页面最下面的容器健康度显示了，此外pod运行状态大标题却出现在

---

_**Assistant**_



---

