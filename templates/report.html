<!DOCTYPE html>
<html>
<head>
    <!--<title>ÈõÜÁæ§Á≥ªÁªüÁõëÊéßÂ∑°Ê£ÄÊä•Âëä</title>-->
    <title>{{.Project}}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-item .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        .stat-item .value {
            font-size: 1.2em;
            font-weight: bold;
        }
        .stat-item .value.alert {
            color: #dc3545;
        }
        .stat-item .value .critical {
            color: #dc3545;
            margin-right: 10px;
        }
        .stat-item .value .warning {
            color: #ffc107;
        }

        /* Ë°®Ê†ºÊ†∑Âºè */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: auto;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            min-width: 100px;
        }

        /* ÊåáÊ†áÂêçÁß∞Âàó */
        th:first-child, td:first-child {
            min-width: 150px;
        }

        /* Ê£ÄÊµãÊó∂Èó¥Âàó */
        th:last-child, td:last-child {
            min-width: 180px;
        }

        /* Áä∂ÊÄÅÂàó */
        th:nth-last-child(2), td:nth-last-child(2) {
            min-width: 80px;
        }

        /* ÂÄºÂàó */
        th:nth-last-child(3), td:nth-last-child(3) {
            min-width: 100px;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        /* Ë°®Ê†ºË°åÁä∂ÊÄÅÊ†∑Âºè */
        tr.warning { 
            background-color: #fff3cd !important;
        }
        tr.normal { 
            background-color: #d4edda !important;
        }
        tr.critical { 
            background-color: #f8d7da !important;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .label-value {
            display: inline-block;
            background-color: #e9ecef;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            word-break: break-all;
            white-space: normal;
        }

        h1, h2, h3 {
            color: #333;
        }
        .section {
            margin-bottom: 30px;
        }
        .chart-container {
            height: 400px;
            margin-bottom: 30px;
        }

        /* Êú∫Âô®Ê†ºÂ≠êÂõæÊ†∑Âºè */
        .machine-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .machine-cell {
            width: 30px;
            height: 30px;
            border-radius: 3px;
            background-color: #4CAF50; /* ÈªòËÆ§‰∏∫ÁªøËâ≤ÔºàÊ≠£Â∏∏Ôºâ */
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
        }
        
        .machine-cell.offline {
            background-color: #d3d3d3; /* ÁÅ∞Ëâ≤Ë°®Á§∫ÂÅúÊú∫ */
            color: #333;
        }
        
        .machine-cell.warning {
            background-color: #ffc107; /* ÈªÑËâ≤Ë°®Á§∫Ë≠¶Âëä */
            color: #333;
        }
        
        .machine-cell.critical {
            background-color: #dc3545; /* Á∫¢Ëâ≤Ë°®Á§∫‰∏•Èáç */
            color: white;
        }
        
        .machine-status-legend {
            display: flex;
            margin-bottom: 20px;
            font-size: 12px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 20px;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin-right: 5px;
        }
        
        .legend-color.normal {
            background-color: #4CAF50;
        }
        
        .legend-color.warning {
            background-color: #ffc107;
        }
        
        .legend-color.critical {
            background-color: #dc3545;
        }
        
        .legend-color.offline {
            background-color: #d3d3d3;
        }
        
        .tooltip {
            visibility: hidden;
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 12px;
            white-space: pre-line;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s;
            text-align: left;
            min-width: 180px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .machine-cell:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .tooltip-row {
            display: flex;
            margin-bottom: 5px;
        }
        
        .tooltip-label {
            font-weight: bold;
            width: 70px;
            color: #cccccc;
        }
        
        .tooltip-value {
            color: white;
        }
        
        .inline-status {
            display: inline-block;
            vertical-align: middle;
        }
        
        .machine-count {
            margin-left: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        /* ÂìçÂ∫îÂºèÊîØÊåÅ */
        @media screen and (max-width: 1200px) {
            .container {
                padding: 10px;
            }
            
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            td, th {
                white-space: nowrap;
            }
        }

        /* PodÁä∂ÊÄÅÊ†ºÂ≠êÊ†∑Âºè */
        .pod-status-section {
            margin-bottom: 30px;
        }

        .namespace-section {
            margin-bottom: 20px;
        }

        .namespace-title {
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
            padding-left: 5px;
            border-left: 4px solid #4CAF50;
        }

        .pod-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 15px;
            align-items: center;
        }

        .pod-cell {
            width: 30px;
            height: 30px;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
        }

        .pod-cell.running {
            background-color: #4CAF50; /* ÁªøËâ≤Ë°®Á§∫Running */
        }

        .pod-cell.succeeded {
            background-color: #4CAF50; /* ÁªøËâ≤Ë°®Á§∫Succeeded */
        }

        .pod-cell.pending {
            background-color: #ffc107; /* ÈªÑËâ≤Ë°®Á§∫Pending */
            color: #333;
        }

        .pod-cell.failed {
            background-color: #dc3545; /* Á∫¢Ëâ≤Ë°®Á§∫Failed */
        }

        .pod-cell.unknown {
            background-color: #6c757d; /* ÁÅ∞Ëâ≤Ë°®Á§∫Unknown */
        }

        .pod-count {
            margin-left: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .pod-status-legend {
            display: flex;
            margin: 10px 0 20px 0;
            font-size: 12px;
            flex-wrap: wrap;
        }

        .pod-status-legend .legend-item {
            display: flex;
            align-items: center;
            margin-right: 20px;
            margin-bottom: 5px;
        }

        .pod-status-legend .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin-right: 5px;
        }

        .pod-status-legend .legend-color.running,
        .pod-status-legend .legend-color.succeeded {
            background-color: #4CAF50;
        }

        .pod-status-legend .legend-color.pending {
            background-color: #ffc107;
        }

        .pod-status-legend .legend-color.failed {
            background-color: #dc3545;
        }

        .pod-status-legend .legend-color.unknown {
            background-color: #6c757d;
        }

        .pod-cell:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        /* ÂÅ•Â∫∑Áä∂ÊÄÅÊòæÁ§∫Âå∫ÂüüÊ†∑Âºè */
        .health-cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }

        /* ËäÇÁÇπÂÅ•Â∫∑Áä∂ÊÄÅÊ†∑Âºè */
        .node-health-section {
            margin: 0;
            padding: 0;
            flex: 1;
            min-width: 300px;
        }

        /* HarborÂÅ•Â∫∑Áä∂ÊÄÅÊ†∑Âºè */
        .harbor-health-section {
            margin: 0;
            padding: 0;
            flex: 1;
            min-width: 300px;
        }

        /* Áªü‰∏ÄÁöÑÂÅ•Â∫∑Áä∂ÊÄÅÊ†∑Âºè */
        .health-status {
            display: inline-flex;
            align-items: center;
            padding: 15px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            width: 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .health-status.healthy {
            background-color: #d4edda;
            color: #155724;
        }

        .health-status.warning {
            background-color: #fff3cd;
            color: #856404;
        }

        .health-status.critical {
            background-color: #f8d7da;
            color: #721c24;
        }

        .health-status-icon {
            font-size: 20px;
            margin-right: 10px;
        }

        .harbor-components {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .harbor-component {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border-radius: 6px;
            background-color: white;
            min-width: 180px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .harbor-component.healthy {
            border-left: 3px solid #4CAF50;
        }

        .harbor-component.unhealthy {
            border-left: 3px solid #dc3545;
        }

        .component-name {
            font-weight: bold;
            color: #333;
        }

        .component-status {
            color: #4CAF50;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            background-color: #f0fff4;
        }

        .harbor-component.unhealthy .component-status {
            color: #dc3545;
            background-color: #fff5f5;
        }

        .node-health-warning {
            font-size: 14px;
            color: #721c24;
            margin: 5px 0;
        }

        /* ËµÑÊ∫ê‰ΩøÁî®ÁéáÂõæ‰æã */
        .resource-usage-legend {
            display: flex;
            margin-top: 10px;
            font-size: 12px;
            flex-wrap: wrap;
        }

        .resource-usage-legend .legend-item {
            display: flex;
            align-items: center;
            margin-right: 20px;
            margin-bottom: 5px;
        }

        .resource-usage-legend .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin-right: 5px;
        }

        .resource-usage-legend .legend-color.normal {
            background-color: #d4edda;
        }

        .resource-usage-legend .legend-color.warning {
            background-color: #fff3cd;
        }

        .resource-usage-legend .legend-color.critical {
            background-color: #f8d7da;
        }

        /* ËäÇÁÇπÂíåËµÑÊ∫ê‰ΩøÁî®ÁéáÊ†∑Âºè */
        .dashboard-section {
            margin: 20px 0;
            padding: 0;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding: 8px 15px;
            background-color: #f5f5f5;
            border-left: 4px solid #4CAF50;
            border-radius: 0 4px 4px 0;
            display: flex;
            align-items: center;
        }

        .section-title-icon {
            margin-right: 8px;
            font-size: 18px;
        }

        .section-title.pods {
            border-left-color: #4a90e2;
        }

        .section-title.nodes {
            border-left-color: #28a745;
        }

        .section-title.resources {
            border-left-color: #ffc107;
        }

        .section-title.registry {
            border-left-color: #17a2b8;
        }

        .metrics-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .metric-card {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 20px;
            text-align: center;
            min-width: 150px;
            flex: 1;
        }

        .metric-card.normal {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }

        .metric-card.warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .metric-card.critical {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .metric-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 14px;
            color: #666;
        }

        /* HarborÊúçÂä°Áä∂ÊÄÅÊ†∑Âºè */
        .harbor-status-card {
            background-color: #d4edda;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .harbor-status-icon {
            font-size: 20px;
            color: #155724;
            margin-right: 10px;
        }

        .harbor-status-text {
            font-size: 16px;
            font-weight: bold;
            color: #155724;
        }

        .components-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .component-card {
            background-color: #fff;
            border-radius: 6px;
            border-left: 3px solid #4CAF50;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 180px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .component-name {
            font-weight: bold;
            color: #333;
        }

        .component-status {
            color: #4CAF50;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            background-color: #f0fff4;
        }

        .component-card.unhealthy {
            border-left-color: #dc3545;
        }

        .component-card.unhealthy .component-status {
            color: #dc3545;
            background-color: #fff5f5;
        }

        /* ËµÑÊ∫êÂõæ‰æãÊ†∑Âºè */
        .resource-legend {
            display: flex;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 20px;
            margin-bottom: 5px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin-right: 5px;
        }

        .legend-color.normal {
            background-color: #d4edda;
        }

        .legend-color.warning {
            background-color: #fff3cd;
        }

        .legend-color.critical {
            background-color: #f8d7da;
        }

        /* Ê†áÈ¢òÊ†∑Âºè */
        .overview-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin: 20px 0;
            padding: 10px 15px;
            background-color: #f0f8ff;
            border-left: 5px solid #4a90e2;
            border-radius: 0 5px 5px 0;
        }

        /* Â±ÇÁ∫ßÊ†áÈ¢òÊ†∑Âºè */
        .report-main-section {
            margin: 25px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            background-color: #fff;
        }

        .main-section-header {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            background-color: #4a90e2;
            padding: 12px 15px;
            display: flex;
            align-items: center;
        }

        .main-section-icon {
            margin-right: 10px;
            font-size: 20px;
        }

        .subsection {
            margin: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            overflow: hidden;
        }

        .subsection-header {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            background-color: #f0f0f0;
            padding: 10px 15px;
            border-left: 4px solid #4CAF50;
            display: flex;
            align-items: center;
        }

        .subsection-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        .subsection-content {
            padding: 15px;
        }

        .subsection-header.nodes {
            border-left-color: #28a745;
        }

        .subsection-header.resources {
            border-left-color: #ffc107;
        }

        .subsection-header.registry {
            border-left-color: #17a2b8;
        }

        .subsection-header.pods {
            border-left-color: #4a90e2;
        }

        .machine-cell.normal, .legend-color.normal {
            background-color: #4CAF50;
            color: white;
        }
        .machine-cell.warning, .legend-color.warning {
            background-color: #ffc107;
            color: #333;
        }
        .machine-cell.critical, .legend-color.critical {
            background-color: #dc3545;
            color: white;
        }
        .machine-cell.offline, .legend-color.offline {
            background-color: #d3d3d3;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <!--<h1>ÈõÜÁæ§Á≥ªÁªüÁõëÊéßÂ∑°Ê£ÄÊä•Âëä</h1>-->
        <h1 style="text-align: center">{{.Project}}</h1>
        <p>ÁîüÊàêÊó∂Èó¥: {{.Timestamp.Format "2006-01-02 15:04:05"}}</p>

        <!-- Â∑°Ê£ÄÊ¶ÇËßàÂç°Áâá - Êõø‰ª£ÂéüÊúâÁöÑÂü∫Á°ÄËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ -->
        <div class="report-main-section">
            <div class="main-section-header">
                <span class="main-section-icon">üìã</span>
                <span>Â∑°Ê£ÄÊ¶ÇËßà</span>
            </div>
            
            <!-- Ê¶ÇËßàÂç°Áâá -->
            <div class="summary-cards">
                {{range $type, $group := .MetricGroups}}
                <div class="card {{$type}}">
                    <h3>{{$type}}</h3>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="label">ÊúÄÂ§ßÂÄº</div>
                            <div class="value">{{printf "%.2f" $group.Stats.MaxValue}}</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">ÊúÄÂ∞èÂÄº</div>
                            <div class="value">{{printf "%.2f" $group.Stats.MinValue}}</div>
                        </div>
                        <!-- <div class="stat-item">
                            <div class="label">Âπ≥ÂùáÂÄº</div>
                            <div class="value">{{printf "%.2f" $group.Stats.Average}}</div>
                        </div> -->
                        <div class="stat-item">
                            <div class="label">ÂëäË≠¶Êï∞</div>
                            <div class="value {{if gt $group.Stats.AlertCount 0}}alert{{end}}">
                                {{$group.Stats.AlertCount}}/{{$group.Stats.TotalCount}}
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="label">ÂëäË≠¶ËØ¶ÊÉÖ</div>
                            <div class="value">
                                <span class="critical">‰∏•Èáç:{{$group.Stats.CriticalCount}}</span>
                                <span class="warning">Ë≠¶Âëä:{{$group.Stats.WarningCount}}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {{end}}
            </div>
        </div>

        <!-- ÂõæË°®ÈÉ®ÂàÜ -->
        <div class="section">
            <div class="section-title">
                <span class="section-title-icon">üñ•Ô∏è</span>
                <span>ÊúçÂä°Âô®Á°¨‰ª∂Áä∂ÊÄÅ</span>
            </div>
            
            <div class="machine-grid" id="machineGrid">
                <!-- ËøôÈáå‰ºöÈÄöËøáJavaScriptÂä®ÊÄÅÂ°´ÂÖÖÊ†ºÂ≠ê -->
            </div>
        </div>

        <!-- ÂÆπÂô®ÂåñÂπ≥Âè∞ÂÅ•Â∫∑Â∫¶Âå∫ÂùóÔºå‰øùÁïôÂéüÊúâÂ±ïÁ§∫ -->
        {{with $group := index .MetricGroups "Âü∫Á°ÄËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ"}}
            {{with $metrics := index $group.MetricsByName "PodËøêË°åÁä∂ÊÄÅ"}}
                <div class="pod-status-section">
                    <div class="report-main-section">
                        <div class="main-section-header">
                            <span class="main-section-icon">üîç</span>
                            <span>ÂÆπÂô®ÂåñÂπ≥Âè∞ÂÅ•Â∫∑Â∫¶</span>
                        </div>
                        <div class="subsection-content">
                            <!-- ËäÇÁÇπÂÅ•Â∫∑Áä∂ÂÜµ -->
                            <div class="dashboard-section">
                                <div class="section-title nodes">
                                    <span class="section-title-icon">‚úì</span>
                                    <span>ËäÇÁÇπÂÅ•Â∫∑Áä∂ÂÜµ</span>
                                </div>
                                <div class="metrics-container">
                                    <div class="metric-card">
                                        <div class="metric-value">{{$.NodeHealth.Ready}}/{{$.NodeHealth.Total}}</div>
                                        <div class="metric-label">ËäÇÁÇπÂ∞±Áª™Áä∂ÊÄÅ</div>
                                    </div>
                                </div>
                                {{if gt $.NodeHealth.NotReady 0}}
                                <div class="node-health-warning">
                                    <span class="critical">Êúâ {{$.NodeHealth.NotReady}} ‰∏™ËäÇÁÇπÊú™Â∞±Áª™</span>
                                </div>
                                {{end}}
                            </div>
                            <!-- ÈõÜÁæ§ËµÑÊ∫ê‰ΩøÁî®Áéá -->
                            <div class="dashboard-section">
                                <div class="section-title resources">
                                    <span class="section-title-icon">üìä</span>
                                    <span>ÈõÜÁæ§ËµÑÊ∫ê‰ΩøÁî®Áéá</span>
                                </div>
                                <div class="metrics-container">
                                    <div class="metric-card {{if floatLessThanEqual $.NodeHealth.ClusterCPUUsage 60.0}}normal{{else if floatLessThanEqual $.NodeHealth.ClusterCPUUsage 80.0}}warning{{else}}critical{{end}}">
                                        <div class="metric-value">{{printf "%.2f" $.NodeHealth.ClusterCPUUsage}}%</div>
                                        <div class="metric-label">CPU‰ΩøÁî®Áéá</div>
                                    </div>
                                    <div class="metric-card {{if floatLessThanEqual $.NodeHealth.ClusterMemoryUsage 70.0}}normal{{else if floatLessThanEqual $.NodeHealth.ClusterMemoryUsage 85.0}}warning{{else}}critical{{end}}">
                                        <div class="metric-value">{{printf "%.2f" $.NodeHealth.ClusterMemoryUsage}}%</div>
                                        <div class="metric-label">ÂÜÖÂ≠ò‰ΩøÁî®Áéá</div>
                                    </div>
                                </div>
                                <div class="resource-legend">
                                    <div class="legend-item">
                                        <div class="legend-color normal"></div>
                                        <div>Ê≠£Â∏∏ (CPU‚â§60%, ÂÜÖÂ≠ò‚â§70%)</div>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color warning"></div>
                                        <div>Ë≠¶Âëä (60%&lt;CPU‚â§80%, 70%&lt;ÂÜÖÂ≠ò‚â§85%)</div>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color critical"></div>
                                        <div>‰∏•Èáç (CPU&gt;80%, ÂÜÖÂ≠ò&gt;85%)</div>
                                    </div>
                                </div>
                            </div>
                            <!-- HarborÂÅ•Â∫∑ -->
                            {{if $.HarborHealth}}
                            <div class="dashboard-section">
                                <div class="section-title registry">
                                    <span class="section-title-icon">üóÉÔ∏è</span>
                                    <span>ÂÆπÂô®ÈïúÂÉè‰ªìÂ∫ì</span>
                                </div>
                                <div class="harbor-status-card">
                                    <span class="harbor-status-icon">{{if eq $.HarborHealth.Status "healthy"}}‚úì{{else}}‚úó{{end}}</span>
                                    <span class="harbor-status-text">HarborÊúçÂä°Áä∂ÊÄÅ: {{$.HarborHealth.Status}}</span>
                                </div>
                                <div class="components-container">
                                    {{range $.HarborHealth.Components}}
                                    <div class="component-card {{.Status}}">
                                        <span class="component-name">{{.Name}}</span>
                                        <span class="component-status">{{.Status}}</span>
                                    </div>
                                    {{end}}
                                </div>
                            </div>
                            {{end}}
                            <!-- PodËøêË°åÁä∂ÊÄÅ -->
                            <div class="dashboard-section">
                                <div class="section-title pods">
                                    <span class="section-title-icon">üì¶</span>
                                    <span>PodËøêË°åÁä∂ÊÄÅ</span>
                                </div>
                                {{$namespaceGroups := (groupPodsByNamespace $metrics)}}
                                {{range $namespace, $podMetrics := $namespaceGroups}}
                                <div class="namespace-section">
                                    <h4 class="namespace-title">ÂëΩÂêçÁ©∫Èó¥: {{$namespace}}</h4>
                                    <div class="pod-grid">
                                        {{range $podMetric := $podMetrics}}
                                            <div class="pod-cell {{getPodStatusClass (getPodPhase $podMetric.Labels)}}">
                                                <div class="tooltip">
                                                    <div class="tooltip-row">
                                                        <span class="tooltip-label">PodÂêçÁß∞:</span>
                                                        <span class="tooltip-value">{{getPodName $podMetric.Labels}}</span>
                                                    </div>
                                                    <div class="tooltip-row">
                                                        <span class="tooltip-label">ÂëΩÂêçÁ©∫Èó¥:</span>
                                                        <span class="tooltip-value">{{getNamespace $podMetric.Labels}}</span>
                                                    </div>
                                                    <div class="tooltip-row">
                                                        <span class="tooltip-label">Áä∂ÊÄÅ:</span>
                                                        <span class="tooltip-value">{{getPodPhase $podMetric.Labels}}</span>
                                                    </div>
                                                    <div class="tooltip-row">
                                                        <span class="tooltip-label">Ê£ÄÊµãÊó∂Èó¥:</span>
                                                        <span class="tooltip-value">{{$podMetric.Timestamp.Format "2006-01-02 15:04:05"}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        {{end}}
                                        <div class="pod-count">ÊÄªËÆ°: {{len $podMetrics}}‰∏™Pod</div>
                                    </div>
                                </div>
                                {{end}}
                                <div class="pod-status-legend">
                                    <div class="legend-item">
                                        <div class="legend-color running"></div>
                                        <div>Running</div>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color succeeded"></div>
                                        <div>Succeeded</div>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color pending"></div>
                                        <div>Pending</div>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color failed"></div>
                                        <div>Failed</div>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color unknown"></div>
                                        <div>Unknown</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {{end}}
        {{end}}

        <!-- Ëá™ÂÆö‰πâÊåáÊ†áÈ°πÁªÑÂ±ïÁ§∫Âå∫ -->
        {{with $customGroup := index .MetricGroups "Ëá™ÂÆö‰πâÊåáÊ†áÈ°πÁªÑ"}}
        <div class="section">
            <h2>Ëá™ÂÆö‰πâÊåáÊ†áÈ°πÁªÑ</h2>
            {{range $metricName, $metrics := $customGroup.MetricsByName}}
                <h3><li>{{$metricName}}</li></h3>
                {{if eq (len $metrics) 0 }}
                    <p>Êú™Êü•ËØ¢Âà∞Êï∞ÊçÆ</p>
                {{else}}
                <table>
                    <tr>
                        <th>ÊåáÊ†áÂêçÁß∞</th>
                        {{$headerLabels := (index $metrics 0).Labels}}
                        {{range $headerLabels}}
                            <th data-label-name="{{.Name}}">{{.Alias}}</th>
                        {{end}}
                        <th>ÂÄº</th>
                        <th>Áä∂ÊÄÅ</th>
                        <th>Ê£ÄÊµãÊó∂Èó¥</th>
                    </tr>
                    {{range $metric := $metrics}}
                    <tr class="{{.Status}}">
                        <td>{{.Name}}</td>
                        {{range $headerLabels}}
                            {{$labelName := .Name}}
                            {{range $metricLabel := $metric.Labels}}
                                {{if eq $metricLabel.Name $labelName}}
                                    <td data-label-name="{{$labelName}}">
                                        <span class="label-value">{{$metricLabel.Value}}</span>
                                    </td>
                                {{end}}
                            {{end}}
                        {{end}}
                        <td>{{printf "%.2f" $metric.Value}}{{.Unit}}</td>
                        <td>
                            {{if eq .Status "normal"}}Ê≠£Â∏∏
                            {{else if eq .Status "warning"}}Ë≠¶Âëä
                            {{else if eq .Status "critical"}}‰∏•Èáç
                            {{else}}{{.Status}}
                            {{end}}
                        </td>
                        <td>{{.Timestamp.Format "2006-01-02 15:04:05"}}</td>
                    </tr>
                    {{end}}
                </table>
                {{end}}
            {{end}}
        </div>
        {{end}}
    </div>

<script>
    // ÁîüÊàêÈöèÊú∫È¢úËâ≤
    function getRandomColor() {
        const hue = Math.random() * 360;
        return {
            background: `hsla(${hue}, 70%, 95%, 1)`,
            border: `hsla(${hue}, 70%, 70%, 1)`
        };
    }

    // ËÆæÁΩÆÂç°ÁâáÊ†∑Âºè
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.card');
        const cardCount = cards.length;
        
        // Ê†πÊçÆÂç°ÁâáÊï∞Èáè‰ºòÂåñÂ∏ÉÂ±Ä
        const container = document.querySelector('.summary-cards');
        if (cardCount <= 2) {
            container.style.gridTemplateColumns = `repeat(${cardCount}, 1fr)`;
        } else if (cardCount <= 4) {
            container.style.gridTemplateColumns = 'repeat(2, 1fr)';
        }

        // ‰∏∫ÊØè‰∏™Âç°ÁâáËÆæÁΩÆÈöèÊú∫È¢úËâ≤
        cards.forEach(card => {
            const colors = getRandomColor();
            card.style.backgroundColor = colors.background;
            card.style.borderLeft = `4px solid ${colors.border}`;
        });
    });
</script>

<script>
    // Â∞ÜÊï∞ÊçÆ‰Ωú‰∏∫JavaScriptÂèòÈáèÂµåÂÖ•È°µÈù¢
    var data = JSON.parse('{{toJSON .MetricGroups}}');

    // Ëé∑Âèñsystem_uptimeÊï∞ÊçÆÂπ∂Ê∏≤ÊüìÊú∫Âô®Ê†ºÂ≠êÂõæ
    document.addEventListener('DOMContentLoaded', function() {
        // Ëé∑ÂèñÊâÄÊúâÊú∫Âô®ÂàóË°®ÔºàÊ†πÊçÆÂ∑≤ÊúâÊåáÊ†á‰∏≠ÁöÑidentÊ†áÁ≠æÊ±áÊÄªÔºâ
        function getAllMachines() {
            const allMachines = new Set();
            
            for (const [type, group] of Object.entries(data)) {
                if (group.MetricsByName) {
                    for (const [metricName, metrics] of Object.entries(group.MetricsByName)) {
                        for (const metric of metrics) {
                            // ÂØªÊâæidentÊ†áÁ≠æ
                            const identLabel = metric.Labels.find(label => label.Name === "ident");
                            if (identLabel && identLabel.Value) {
                                allMachines.add(identLabel.Value);
                            }
                        }
                    }
                }
            }
            
            // ËΩ¨Êç¢‰∏∫Êï∞ÁªÑÂπ∂ÊåâIPÂú∞ÂùÄÊéíÂ∫èÔºàÂ¶ÇÊûúÊòØIPÂú∞ÂùÄÁöÑËØùÔºâ
            return Array.from(allMachines).sort((a, b) => {
                if (a.match(/^\d+\.\d+\.\d+\.\d+$/) && b.match(/^\d+\.\d+\.\d+\.\d+$/)) {
                    // Â¶ÇÊûúÈÉΩÊòØIPÂú∞ÂùÄÔºåÊåâIPÊéíÂ∫è
                    const ipA = a.split('.').map(num => parseInt(num, 10));
                    const ipB = b.split('.').map(num => parseInt(num, 10));
                    
                    for (let i = 0; i < 4; i++) {
                        if (ipA[i] !== ipB[i]) {
                            return ipA[i] - ipB[i];
                        }
                    }
                    return 0;
                } else {
                    // Âê¶ÂàôÊåâÂ≠óÁ¨¶‰∏≤ÊéíÂ∫è
                    return a.localeCompare(b);
                }
            });
        }
        
        // Ëé∑ÂèñÊú∫Âô®ÁöÑsystem_uptime
        function getMachineUptime(machineIdent) {
            let uptime = null;
            
            // Â∞ùËØï‰ªéÊåáÊ†áÊï∞ÊçÆ‰∏≠ÊâæÂà∞ÂØπÂ∫îÊú∫Âô®ÁöÑsystem_uptime‰ø°ÊÅØ
            for (const [type, group] of Object.entries(data)) {
                if (group.MetricsByName && group.MetricsByName['Á≥ªÁªüËøêË°åÊó∂Èó¥']) {
                    for (const metric of group.MetricsByName['Á≥ªÁªüËøêË°åÊó∂Èó¥']) {
                        const identLabel = metric.Labels.find(label => label.Name === "ident");
                        if (identLabel && identLabel.Value === machineIdent) {
                            uptime = metric.Value;
                            break;
                        }
                    }
                }
            }
            
            return uptime;
        }
        
        // Ëé∑ÂèñÊú∫Âô®Áä∂ÊÄÅÔºànormal, warning, criticalÔºâ
        function getMachineStatus(machineIdent) {
            let cpuUsage = null;
            let memUsage = null;
            let diskUsage = null;
            
            // Ëé∑ÂèñCPU‰ΩøÁî®Áéá
            for (const [type, group] of Object.entries(data)) {
                if (group.MetricsByName && group.MetricsByName['CPU‰ΩøÁî®Áéá']) {
                    for (const metric of group.MetricsByName['CPU‰ΩøÁî®Áéá']) {
                        const identLabel = metric.Labels.find(label => label.Name === "ident");
                        if (identLabel && identLabel.Value === machineIdent) {
                            cpuUsage = metric.Value;
                            break;
                        }
                    }
                }
            }
            
            // Ëé∑ÂèñÂÜÖÂ≠ò‰ΩøÁî®Áéá
            for (const [type, group] of Object.entries(data)) {
                if (group.MetricsByName && group.MetricsByName['ÂÜÖÂ≠ò‰ΩøÁî®Áéá']) {
                    for (const metric of group.MetricsByName['ÂÜÖÂ≠ò‰ΩøÁî®Áéá']) {
                        const identLabel = metric.Labels.find(label => label.Name === "ident");
                        if (identLabel && identLabel.Value === machineIdent) {
                            memUsage = metric.Value;
                            break;
                        }
                    }
                }
            }
            
            // Ëé∑ÂèñÊ†πÂàÜÂå∫‰ΩøÁî®Áéá
            for (const [type, group] of Object.entries(data)) {
                if (group.MetricsByName && group.MetricsByName['Á£ÅÁõò‰ΩøÁî®Áéá']) {
                    for (const metric of group.MetricsByName['Á£ÅÁõò‰ΩøÁî®Áéá']) {
                        const identLabel = metric.Labels.find(label => label.Name === "ident");
                        const pathLabel = metric.Labels.find(label => (label.Name === "path" || label.Name === "mountpoint") && (label.Value === "/" || label.Value === "rootfs"));
                        if (identLabel && identLabel.Value === machineIdent && pathLabel) {
                            diskUsage = metric.Value;
                            break;
                        }
                    }
                }
                
                // Â∞ùËØï‰ΩøÁî®"Ê†πÂàÜÂå∫Á£ÅÁõò‰ΩøÁî®Áéá"ÊåáÊ†á
                if (diskUsage === null && group.MetricsByName && group.MetricsByName['Ê†πÂàÜÂå∫Á£ÅÁõò‰ΩøÁî®Áéá']) {
                    for (const metric of group.MetricsByName['Ê†πÂàÜÂå∫Á£ÅÁõò‰ΩøÁî®Áéá']) {
                        const identLabel = metric.Labels.find(label => label.Name === "ident");
                        if (identLabel && identLabel.Value === machineIdent) {
                            diskUsage = metric.Value;
                            break;
                        }
                    }
                }
            }
            
            // Ê†πÊçÆCPU„ÄÅÂÜÖÂ≠òÂíåÁ£ÅÁõò‰ΩøÁî®ÁéáÂà§Êñ≠Áä∂ÊÄÅ
            if (cpuUsage === null && memUsage === null && diskUsage === null) {
                return 'offline';
            }
            
            // Â¶ÇÊûúCPU„ÄÅÂÜÖÂ≠òÊàñÁ£ÅÁõò‰ΩøÁî®ÁéáÂ§ß‰∫é90%ÔºåÂàô‰∏∫‰∏•Èáç
            if ((cpuUsage !== null && cpuUsage > 90) || 
                (memUsage !== null && memUsage > 90) ||
                (diskUsage !== null && diskUsage > 90)) {
                return 'critical';
            }
            
            // Â¶ÇÊûúCPU„ÄÅÂÜÖÂ≠òÊàñÁ£ÅÁõò‰ΩøÁî®ÁéáÂ§ß‰∫é80%ÔºåÂàô‰∏∫Ë≠¶Âëä
            if ((cpuUsage !== null && cpuUsage > 80) ||
                (memUsage !== null && memUsage > 80) ||
                (diskUsage !== null && diskUsage > 80)) {
                return 'warning';
            }
            
            return 'normal';
        }
        
        // Ê†ºÂºèÂåñuptimeÊòæÁ§∫
        function formatUptime(seconds) {
            if (seconds === null) return "Êú™Áü•";
            
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            let result = "";
            if (days > 0) result += `${days}Â§©`;
            if (hours > 0 || days > 0) result += `${hours}Â∞èÊó∂`;
            result += `${minutes}ÂàÜÈíü`;
            
            return result;
        }
        
        // Ê∏≤ÊüìÊú∫Âô®Ê†ºÂ≠êÂõæ
        function renderMachineGrid() {
            const gridContainer = document.getElementById('machineGrid');
            if (!gridContainer) return;
            
            const machines = getAllMachines();
            let machineCount = 0;
            
            for (const machine of machines) {
                machineCount++;
                const status = getMachineStatus(machine);
                const isOnline = status !== 'offline';
                const uptime = getMachineUptime(machine);
                
                const cell = document.createElement('div');
                cell.className = `machine-cell ${status}`;
                
                // ‰∏çÊòæÁ§∫‰ªª‰ΩïÊñáÊú¨
                cell.textContent = '';
                
                // Ëé∑ÂèñCPUÂíåÂÜÖÂ≠ò‰ΩøÁî®ÁéáÁî®‰∫éÊòæÁ§∫
                let cpuUsage = null;
                let memUsage = null;
                let diskUsage = null;
                
                for (const [type, group] of Object.entries(data)) {
                    if (group.MetricsByName) {
                        if (group.MetricsByName['CPU‰ΩøÁî®Áéá']) {
                            for (const metric of group.MetricsByName['CPU‰ΩøÁî®Áéá']) {
                                const identLabel = metric.Labels.find(label => label.Name === "ident");
                                if (identLabel && identLabel.Value === machine) {
                                    cpuUsage = metric.Value;
                                    break;
                                }
                            }
                        }
                        
                        if (group.MetricsByName['ÂÜÖÂ≠ò‰ΩøÁî®Áéá']) {
                            for (const metric of group.MetricsByName['ÂÜÖÂ≠ò‰ΩøÁî®Áéá']) {
                                const identLabel = metric.Labels.find(label => label.Name === "ident");
                                if (identLabel && identLabel.Value === machine) {
                                    memUsage = metric.Value;
                                    break;
                                }
                            }
                        }
                        
                        if (group.MetricsByName['Á£ÅÁõò‰ΩøÁî®Áéá']) {
                            for (const metric of group.MetricsByName['Á£ÅÁõò‰ΩøÁî®Áéá']) {
                                const identLabel = metric.Labels.find(label => label.Name === "ident");
                                const pathLabel = metric.Labels.find(label => (label.Name === "path" || label.Name === "mountpoint") && (label.Value === "/" || label.Value === "rootfs"));
                                if (identLabel && identLabel.Value === machine && pathLabel) {
                                    diskUsage = metric.Value;
                                    break;
                                }
                            }
                        }
                        
                        // Â∞ùËØï‰ΩøÁî®"Ê†πÂàÜÂå∫Á£ÅÁõò‰ΩøÁî®Áéá"ÊåáÊ†á
                        if (diskUsage === null && group.MetricsByName && group.MetricsByName['Ê†πÂàÜÂå∫Á£ÅÁõò‰ΩøÁî®Áéá']) {
                            for (const metric of group.MetricsByName['Ê†πÂàÜÂå∫Á£ÅÁõò‰ΩøÁî®Áéá']) {
                                const identLabel = metric.Labels.find(label => label.Name === "ident");
                                if (identLabel && identLabel.Value === machine) {
                                    diskUsage = metric.Value;
                                    break;
                                }
                            }
                        }
                    }
                }
                
                // ÂàõÂª∫tooltip
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.innerHTML = `
                    <div class="tooltip-row">
                        <span class="tooltip-label">‰∏ªÊú∫:</span>
                        <span class="tooltip-value">${machine}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">ËøêË°åÊó∂Èó¥:</span>
                        <span class="tooltip-value">${uptime !== null ? formatUptime(uptime) : 'Êú™Áü•'}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">CPU:</span>
                        <span class="tooltip-value">${cpuUsage !== null ? cpuUsage.toFixed(2) + '%' : 'Êú™Áü•'}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">ÂÜÖÂ≠ò:</span>
                        <span class="tooltip-value">${memUsage !== null ? memUsage.toFixed(2) + '%' : 'Êú™Áü•'}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Ê†πÂàÜÂå∫:</span>
                        <span class="tooltip-value">${diskUsage !== null ? diskUsage.toFixed(2) + '%' : 'Êú™Áü•'}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Áä∂ÊÄÅ:</span>
                        <span class="tooltip-value inline-status">${status === 'normal' ? 'Ê≠£Â∏∏' : 
                              status === 'warning' ? 'Ë≠¶Âëä' : 
                              status === 'critical' ? '‰∏•Èáç' : 'Á¶ªÁ∫ø'}</span>
                    </div>
                `;
                
                cell.appendChild(tooltip);
                gridContainer.appendChild(cell);
            }
            
            // Ê∑ªÂä†ÊÄªËÆ°ËØ¥Êòé
            const totalInfo = document.createElement('div');
            totalInfo.className = 'machine-count';
            totalInfo.textContent = `ÊÄªËÆ°: ${machineCount}Âè∞`;
            gridContainer.appendChild(totalInfo);
            
            // ÂàõÂª∫Âõæ‰æã
            const legendContainer = document.createElement('div');
            legendContainer.className = 'machine-status-legend';
            
            // Ê∑ªÂä†ÂêÑÁßçÁä∂ÊÄÅÁöÑÂõæ‰æã
            const statuses = [
                { class: 'normal', text: 'Ê≠£Â∏∏' },
                { class: 'warning', text: 'Ë≠¶Âëä (CPU/ÂÜÖÂ≠ò/Ê†πÂàÜÂå∫ > 80%)' },
                { class: 'critical', text: '‰∏•Èáç (CPU/ÂÜÖÂ≠ò/Ê†πÂàÜÂå∫ > 90%)' },
                { class: 'offline', text: 'Á¶ªÁ∫ø' }
            ];
            
            statuses.forEach(status => {
                const item = document.createElement('div');
                item.className = 'legend-item';
                
                const color = document.createElement('div');
                color.className = `legend-color ${status.class}`;
                
                const text = document.createElement('div');
                text.textContent = status.text;
                
                item.appendChild(color);
                item.appendChild(text);
                legendContainer.appendChild(item);
            });
            
            // Â∞ÜÂõæ‰æãÊ∑ªÂä†Âà∞gridÂêéÈù¢
            const section = gridContainer.parentNode;
            section.insertBefore(legendContainer, gridContainer.nextSibling);
        }
        
        // ÊâßË°åÊ∏≤Êüì
        renderMachineGrid();
    });
</script>

<script>
    // PodÁõ∏ÂÖ≥ÁöÑËæÖÂä©ÂáΩÊï∞ - Áõ¥Êé•‰ΩøÁî®GoÊ®°ÊùøÂáΩÊï∞‰ª£ÊõøÔºå‰∏çÈúÄË¶ÅÂú®JavaScript‰∏≠ÂÜçÂÆö‰πâËøô‰∫õÂäüËÉΩ
    // ‰ΩÜ‰øùÁïôÁ©∫ÁöÑÂåÖË£ÖÂô®ÂáΩÊï∞Ôºå‰ª•Èò≤‰∏á‰∏ÄÊúâÂú∞Êñπ‰ΩøÁî®‰∫ÜÂÆÉ‰ª¨
    function groupPodsByNamespace(podMetrics) {
        console.log("Ê≠§ÂáΩÊï∞Â∑≤Ë¢´GoÊ®°ÊùøÂáΩÊï∞Êõø‰ª£");
        return {};
    }
    
    function getPodName(labels) {
        console.log("Ê≠§ÂáΩÊï∞Â∑≤Ë¢´GoÊ®°ÊùøÂáΩÊï∞Êõø‰ª£");
        return "";
    }
    
    function getPodStatusClass(status) {
        console.log("Ê≠§ÂáΩÊï∞Â∑≤Ë¢´GoÊ®°ÊùøÂáΩÊï∞Êõø‰ª£");
        return "";
    }
</script>
</body>
</html>