<!-- Generated by SpecStory -->

# 巡检报告监控指标与显示问题 (2025-05-17 19:03:54)

_**User**_

那个巡检报告第一部分”基础资源使用情况“使用了哪些监控指标，我怎么看前台显示的不是实际值

---

_**Assistant**_



---

我需要查找巡检报告中关于基础资源使用情况的代码。

---

<details>
            <summary>Searched codebase "巡检报告 基础资源使用情况 监控指标" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `reports/inspection_report_20241227_123648.html` | L11711-11768 |
| `reports/inspection_report_20250517_181340.html` | L343-365 |
| `reports/inspection_report_20250517_184200.html` | L452-481 |
| `reports/inspection_report_20250517_181910.html` | L343-365 |
| `reports/inspection_report_20250517_180609.html` | L343-365 |
| `reports/inspection_report_20250517_181506.html` | L343-365 |
| `reports/inspection_report_20250517_184812.html` | L452-481 |
| `reports/inspection_report_20250517_182855.html` | L343-365 |
| `reports/inspection_report_20241231_201838.html` | L192-248 |
| `reports/inspection_report_20250517_171412.html` | L293-347 |
| `reports/inspection_report_20250517_173709.html` | L293-347 |
| `reports/inspection_report_20250517_180134.html` | L293-347 |
| `reports/inspection_report_20250516_180838.html` | L293-347 |
| `reports/inspection_report_20250517_171500.html` | L293-347 |
| `reports/inspection_report_20250516_180552.html` | L293-347 |
| `reports/inspection_report_20250516_175029.html` | L209-267 |
| `reports/inspection_report_20250516_175527.html` | L288-346 |
| `reports/inspection_report_20250516_175913.html` | L293-351 |
| `reports/inspection_report_20250516_114738.html` | L155-214 |
| `reports/inspection_report_20250515_205237.html` | L155-214 |
| `reports/inspection_report_20250515_205100.html` | L155-214 |
| `reports/inspection_report_20250516_161200.html` | L155-214 |
| `reports/inspection_report_20241231_201838.html` | L686-728 |
| `reports/inspection_report_20250516_171500.html` | L155-208 |
| `reports/inspection_report_20250516_161500.html` | L155-208 |

</details>

---

我们找到了一些巡检报告的HTML文件，但我需要查找更多关于监控指标实际处理和生成的代码，了解这些指标是如何计算和显示的。

---

<details>
            <summary>Searched codebase "基础资源使用情况 指标 生成 计算" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `reports/inspection_report_20241227_123648.html` | L218-258 |
| `reports/inspection_report_20250516_160900.html` | L204-249 |
| `reports/inspection_report_20241231_201838.html` | L192-248 |
| `reports/inspection_report_20250516_175029.html` | L209-267 |
| `reports/inspection_report_20250516_175527.html` | L288-346 |
| `reports/inspection_report_20241227_123648.html` | L11711-11768 |
| `reports/inspection_report_20250516_175913.html` | L293-351 |
| `reports/inspection_report_20250517_180134.html` | L293-347 |
| `reports/inspection_report_20250517_171500.html` | L293-347 |
| `reports/inspection_report_20250517_171412.html` | L293-347 |
| `reports/inspection_report_20250517_184200.html` | L452-481 |
| `reports/inspection_report_20250517_173709.html` | L293-347 |
| `reports/inspection_report_20250515_205100.html` | L155-214 |
| `reports/inspection_report_20250517_181340.html` | L343-365 |
| `reports/inspection_report_20250516_114738.html` | L155-214 |
| `templates/report.html` | L409-454 |
| `reports/inspection_report_20250515_205237.html` | L155-214 |
| `reports/inspection_report_20250517_181910.html` | L343-365 |
| `reports/inspection_report_20250517_180609.html` | L343-365 |
| `reports/inspection_report_20250516_180838.html` | L293-347 |
| `reports/inspection_report_20250516_161200.html` | L155-214 |
| `reports/inspection_report_20250516_180552.html` | L293-347 |
| `reports/inspection_report_20250517_184812.html` | L452-481 |
| `reports/inspection_report_20250516_171500.html` | L155-208 |
| `reports/inspection_report_20250517_181506.html` | L343-365 |

</details>

---

我需要查找更具体的代码，特别是指标的计算和生成相关的源代码，而不只是HTML报告文件。

---

<details>
            <summary>Searched codebase "巡检报告 基础资源使用情况 指标计算 代码" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `reports/inspection_report_20241227_123648.html` | L11711-11768 |
| `reports/inspection_report_20250517_184200.html` | L452-481 |
| `reports/inspection_report_20250517_181340.html` | L343-365 |
| `reports/inspection_report_20250517_181910.html` | L343-365 |
| `reports/inspection_report_20250517_184812.html` | L452-481 |
| `reports/inspection_report_20250517_180609.html` | L343-365 |
| `reports/inspection_report_20250517_181506.html` | L343-365 |
| `reports/inspection_report_20250517_182855.html` | L343-365 |
| `reports/inspection_report_20250517_173709.html` | L293-347 |
| `reports/inspection_report_20250517_180134.html` | L293-347 |
| `reports/inspection_report_20250517_171412.html` | L293-347 |
| `reports/inspection_report_20250517_171500.html` | L293-347 |
| `reports/inspection_report_20250516_180552.html` | L293-347 |
| `reports/inspection_report_20250516_180838.html` | L293-347 |
| `reports/inspection_report_20241231_201838.html` | L192-248 |
| `reports/inspection_report_20250516_175029.html` | L209-267 |
| `reports/inspection_report_20250516_175527.html` | L288-346 |
| `reports/inspection_report_20250516_175913.html` | L293-351 |
| `reports/inspection_report_20250516_114738.html` | L155-214 |
| `reports/inspection_report_20250515_205100.html` | L155-214 |
| `reports/inspection_report_20250515_205237.html` | L155-214 |
| `reports/inspection_report_20241227_123648.html` | L218-258 |
| `reports/inspection_report_20250516_161200.html` | L155-214 |
| `reports/inspection_report_20250517_181340.html` | L293-343 |
| `reports/inspection_report_20250517_181910.html` | L293-343 |

</details>

---

我需要查找更多关于指标收集和计算的后端代码，而不只是HTML模板。让我找找检查业务逻辑的部分代码：

---

<details>
            <summary>Searched codebase "巡检 指标收集 基础资源使用情况 代码实现" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `reports/inspection_report_20241227_123648.html` | L11711-11768 |
| `reports/inspection_report_20241231_201838.html` | L192-248 |
| `reports/inspection_report_20250517_184200.html` | L452-481 |
| `reports/inspection_report_20250517_181340.html` | L343-365 |
| `reports/inspection_report_20250517_180609.html` | L343-365 |
| `reports/inspection_report_20250517_181910.html` | L343-365 |
| `reports/inspection_report_20250517_181506.html` | L343-365 |
| `reports/inspection_report_20250517_184812.html` | L452-481 |
| `reports/inspection_report_20250517_182855.html` | L343-365 |
| `reports/inspection_report_20250517_171500.html` | L293-347 |
| `reports/inspection_report_20250517_171412.html` | L293-347 |
| `reports/inspection_report_20250516_175029.html` | L209-267 |
| `reports/inspection_report_20250516_180552.html` | L293-347 |
| `reports/inspection_report_20250517_180134.html` | L293-347 |
| `reports/inspection_report_20250516_180838.html` | L293-347 |
| `reports/inspection_report_20250517_173709.html` | L293-347 |
| `reports/inspection_report_20250516_175913.html` | L293-351 |
| `reports/inspection_report_20241227_123648.html` | L218-258 |
| `reports/inspection_report_20250516_175527.html` | L288-346 |
| `reports/inspection_report_20250516_114738.html` | L155-214 |
| `reports/inspection_report_20250515_205237.html` | L155-214 |
| `reports/inspection_report_20250515_205100.html` | L155-214 |
| `reports/inspection_report_20250516_161200.html` | L155-214 |
| `reports/inspection_report_20241231_201838.html` | L686-728 |
| `.specstory/history/2025-05-16_09-38-巡检报告资源使用格子图设计.md` | L440-489 |

</details>

---

仍然没有找到关于指标收集和计算的实际代码。让我尝试查找相关的Go代码或Python代码：

---

<details>
            <summary>Searched codebase "基础资源使用情况 指标收集 数据处理 golang" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `pkg/status/status.go` | L104-149 |
| `pkg/status/status.go` | L149-185 |
| `pkg/report/generator.go` | L63-124 |
| `pkg/metrics/collector.go` | L62-94 |
| `pkg/metrics/collector.go` | L94-154 |
| `pkg/status/status.go` | L64-104 |
| `pkg/metrics/collector.go` | L1-62 |
| `pkg/report/generator.go` | L1-63 |
| `pkg/report/generator.go` | L124-173 |
| `pkg/status/status.go` | L226-270 |
| `pkg/status/status.go` | L1-64 |
| `main.go` | L169-222 |
| `pkg/metrics/collector.go` | L154-224 |
| `main.go` | L58-114 |
| `pkg/report/generator.go` | L173-243 |
| `templates/report.html` | L409-454 |
| `pkg/status/status.go` | L185-226 |
| `README.md` | L37-106 |
| `main.go` | L114-169 |
| `templates/report.html` | L454-473 |
| `templates/report.html` | L529-569 |
| `main.go` | L1-58 |
| `config/config.yaml` | L26-87 |
| `.specstory/history/2025-05-16_09-56-格式调整与文本对齐问题.md` | L220-280 |
| `pkg/report/generator.go` | L243-290 |

</details>

---

现在我们找到了一些与巡检报告指标收集和处理相关的代码。让我们详细查看一下 `pkg/metrics/collector.go` 文件，它应该包含指标收集的核心逻辑：

---

Read file: pkg/metrics/collector.go

---

现在我们来看一下配置相关的文件，了解指标是如何定义的：

---

<details>
            <summary>Searched codebase "config.go" • **1** results</summary>
        
| File |
|------|
| `undefined` |

</details>

---

Read file: pkg/config/config.go

---

让我们查找一个具体的配置文件示例：

---

<details>
            <summary>Searched codebase "config.yaml" • **2** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |

</details>

---

Read file: config/config.yaml

---

基于以上信息，我可以回答你的问题了：

巡检报告中"基础资源使用情况"部分使用的监控指标主要来自Prometheus，通过查询相关的指标数据进行统计和展示。具体包括以下几类监控指标：

1. CPU使用率 - 使用`avg by(ident) (cpu_usage_active)`查询，阈值为80%
2. 内存使用率 - 使用`avg by(ident) (mem_used_percent)`查询，阈值为85%
3. 系统运行时间 - 使用`system_uptime`查询
4. 根分区磁盘使用率 - 使用`avg by(ident, path, device) (disk_used_percent{path=~'/'})`查询，阈值为80%
5. /iflytek分区磁盘使用率 - 使用`avg by(ident, path, device) (disk_used_percent{path=~'/iflytek'})`查询，阈值为80%
6. Pod运行状态 - 使用`sum by (namespace, pod, phase) (kube_pod_status_phase == 1)`查询
7. 节点就绪状态 - 使用`kube_node_status_condition{condition='Ready',status!='true'}`查询

关于前台显示的值不是实际值的问题，这可能有几个原因：

1. 数据计算方式：系统会从Prometheus获取原始指标数据，然后根据配置的查询语句进行计算（如平均值、求和等），这些计算后的值可能与你直接从源系统看到的原始值不一致。

2. 数据采样和时间差：巡检报告是基于采样时间点的数据，如果你查看报告时间与实际问题发生时间有差异，数据自然会有所不同。

3. 数据聚合逻辑：代码中的`getStatus`函数显示，系统会根据阈值类型（greater、less等）和具体值对指标进行分类，显示为"正常"、"警告"或"严重"，这也可能导致数据展示方式与实际原始数据不同。

4. 数据转换处理：从代码可以看出，收集到的指标数据经过了一系列处理（如标签处理、状态判断等），这些处理过程可能会影响最终显示的值。

如果你想确认前台显示的具体问题，可以查看日志文件中的`log.Printf("指标 [%s] 原始数据: %+v, 值: %+v", metric.Name, sample.Metric, sample.Value)`输出，对比前台显示与实际采集的原始数据值之间的差异，找出具体问题所在。

---

_**User**_

将pod运行状态这个一部分标题改为容器化平台健康度，并且紧接着下面加入节点的健康情况，你使用1/1  2/3 3、3这种表示节点运行状态，使用合适的ui进行展示，不要复杂，要优雅简介，公式参考sum(kube_node_status_condition{cluster=~".*", condition="Ready"})，sum(kube_node_status_condition{cluster=~".*",condition="Ready", status!="true"})标签为node节点名称；然后，紧接着展示harbor仓库的健康状态，参考： curl -k -u "root:Harbor12345" https://172.30.137.161/api/v2.0/health
{"components":[{"name":"chartmuseum","status":"healthy"},{"name":"core","status":"healthy"},{"name":"database","status":"healthy"},{"name":"jobservice","status":"healthy"},{"name":"portal","status":"healthy"},{"name":"redis","status":"healthy"},{"name":"registry","status":"healthy"},{"name":"registryctl","status":"healthy"}],"status":"healthy"}
；注意这里我会在config里定义harbor仓库地址，默认复用k8s 主节点ip地址，然后同时优雅简洁的展示harbor的健康状况；以上新加入的两块作为容器化平台健康度的总览，紧接着才是pod状态，适当使用方法作为区分，使其格式连贯

---

_**Assistant**_



---

让我先找找相关的报告模板文件和代码：

---

<details>
            <summary>Searched codebase "report template html" • **10** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

Read file: templates/report.html

---

Read file: templates/report.html

---

现在，我需要修改config.yaml添加Harbor相关配置，和编辑HTML模板文件，让我先更新配置文件：

---

```diff
  prometheus-ddp: "172.31.101.239"
  
- 
+ # Harbor仓库配置
+ harbor:
+   enabled: true
+   url: "https://172.30.137.161"  # 默认复用k8s主节点IP地址
+   username: "root"
+   password: "Harbor12345"
+   insecure: true  # 是否忽略证书验证
  
  project_name: "星相运维平台巡检报告"
```

---

现在让我们更新报告模板，添加节点健康和Harbor健康状态：

---

```diff
                      {{if eq $metricName "Pod运行状态"}}
                      <div class="pod-status-section">
+                         <h4>容器化平台健康度</h4>
+                         
+                         <!-- 节点健康情况 -->
+                         <div class="node-health-section">
+                             <h5>节点健康状况</h5>
+                             <div class="node-health-stats">
+                                 <div class="node-health-card">
+                                     <div class="node-health-value">{{.NodeHealth.Ready}}/{{.NodeHealth.Total}}</div>
+                                     <div class="node-health-label">节点就绪状态</div>
+                                 </div>
+                                 {{if gt .NodeHealth.NotReady 0}}
+                                 <div class="node-health-warning">
+                                     <span class="critical">有 {{.NodeHealth.NotReady}} 个节点未就绪</span>
+                                 </div>
+                                 {{end}}
+                             </div>
+                         </div>
+                         
+                         <!-- Harbor健康状态 -->
+                         {{if .HarborHealth}}
+                         <div class="harbor-health-section">
+                             <h5>容器镜像仓库</h5>
+                             <div class="harbor-health-cards">
+                                 <div class="harbor-health-status {{if eq .HarborHealth.Status "healthy"}}healthy{{else}}unhealthy{{end}}">
+                                     <span class="harbor-status-icon">{{if eq .HarborHealth.Status "healthy"}}✓{{else}}✗{{end}}</span>
+                                     <span>Harbor服务状态: {{.HarborHealth.Status}}</span>
+                                 </div>
+                                 
+                                 <div class="harbor-components">
+                                     {{range .HarborHealth.Components}}
+                                     <div class="harbor-component {{.Status}}">
+                                         <span class="component-name">{{.Name}}</span>
+                                         <span class="component-status">{{.Status}}</span>
+                                     </div>
+                                     {{end}}
+                                 </div>
+                             </div>
+                         </div>
+                         {{end}}
+                         
+                         <h5>Pod运行状态</h5>
                          <!-- Pod运行状态格子图按命名空间分组 -->
                          {{$namespaceGroups := (groupPodsByNamespace $metrics)}}
```

---

现在需要添加CSS样式来为新增的节点健康和Harbor健康部分设置样式：

---

```diff
              opacity: 1;
          }
+         
+         /* 节点健康状态样式 */
+         .node-health-section {
+             margin: 15px 0;
+             padding: 15px;
+             background-color: #f8f9fa;
+             border-radius: 8px;
+         }
+         
+         .node-health-stats {
+             display: flex;
+             align-items: center;
+             flex-wrap: wrap;
+             gap: 20px;
+         }
+         
+         .node-health-card {
+             padding: 10px 20px;
+             background-color: white;
+             border-radius: 8px;
+             box-shadow: 0 2px 4px rgba(0,0,0,0.05);
+             text-align: center;
+             min-width: 120px;
+         }
+         
+         .node-health-value {
+             font-size: 24px;
+             font-weight: bold;
+             color: #333;
+         }
+         
+         .node-health-label {
+             font-size: 14px;
+             color: #666;
+             margin-top: 5px;
+         }
+         
+         .node-health-warning {
+             font-size: 14px;
+         }
+         
+         /* Harbor健康状态样式 */
+         .harbor-health-section {
+             margin: 15px 0;
+             padding: 15px;
+             background-color: #f8f9fa;
+             border-radius: 8px;
+         }
+         
+         .harbor-health-cards {
+             display: flex;
+             flex-direction: column;
+             gap: 15px;
+         }
+         
+         .harbor-health-status {
+             display: inline-flex;
+             align-items: center;
+             padding: 10px 15px;
+             border-radius: 8px;
+             font-size: 16px;
+             font-weight: bold;
+             margin-bottom: 10px;
+         }
+         
+         .harbor-health-status.healthy {
+             background-color: #d4edda;
+             color: #155724;
+         }
+         
+         .harbor-health-status.unhealthy {
+             background-color: #f8d7da;
+             color: #721c24;
+         }
+         
+         .harbor-status-icon {
+             font-size: 20px;
+             margin-right: 10px;
+         }
+         
+         .harbor-components {
+             display: flex;
+             flex-wrap: wrap;
+             gap: 10px;
+             margin-top: 10px;
+         }
+         
+         .harbor-component {
+             display: flex;
+             align-items: center;
+             justify-content: space-between;
+             padding: 8px 12px;
+             border-radius: 6px;
+             background-color: white;
+             min-width: 180px;
+             box-shadow: 0 1px 3px rgba(0,0,0,0.05);
+         }
+         
+         .harbor-component.healthy {
+             border-left: 3px solid #4CAF50;
+         }
+         
+         .harbor-component.unhealthy {
+             border-left: 3px solid #dc3545;
+         }
+         
+         .component-name {
+             font-weight: bold;
+             color: #333;
+         }
+         
+         .component-status {
+             color: #4CAF50;
+             font-size: 12px;
+             padding: 2px 8px;
+             border-radius: 12px;
+             background-color: #f0fff4;
+         }
+         
+         .harbor-component.unhealthy .component-status {
+             color: #dc3545;
+             background-color: #fff5f5;
+         }
      </style>
  </head>
```

---

现在，我需要为节点健康和Harbor健康状态添加数据收集代码。让我们修改collector.go：

---

```diff
  import (
  	"context"
+ 	"encoding/json"
  	"fmt"
  	"html/template"
  	"log"
+ 	"net/http"
  	"time"
+ 	"crypto/tls"
+ 	"io/ioutil"
  
  	v1 "github.com/prometheus/client_golang/api/prometheus/v1"
```

```diff
  	QueryRange(ctx context.Context, query string, r v1.Range, opts ...v1.Option) (model.Value, v1.Warnings, error)
  }
+ 
+ // 节点健康状态结构
+ type NodeHealth struct {
+ 	Total    int
+ 	Ready    int
+ 	NotReady int
+ }
+ 
+ // Harbor健康状态结构
+ type HarborHealth struct {
+ 	Status     string
+ 	Components []HarborComponent
+ }
+ 
+ type HarborComponent struct {
+ 	Name   string
+ 	Status string
+ }
  
  // NewCollector 创建新的收集器
```

```diff
  	return promClient.API, nil
  }
+ 
+ // CollectNodeHealth 收集节点健康状态
+ func (c *Collector) CollectNodeHealth() (*NodeHealth, error) {
+ 	ctx := context.Background()
+ 	k8sPrometheusURL := c.config.GetK8sPrometheusURL()
+ 	
+ 	// 获取适用于K8s的Prometheus客户端
+ 	var k8sClient PrometheusAPI
+ 	var err error
+ 	
+ 	if k8sPrometheusURL != "" {
+ 		// 使用K8s特定的Prometheus
+ 		promClient, err := prometheus.NewClient(k8sPrometheusURL)
+ 		if err != nil {
+ 			return nil, fmt.Errorf("创建K8s Prometheus客户端失败: %w", err)
+ 		}
+ 		k8sClient = promClient.API
+ 	} else {
+ 		// 使用默认客户端
+ 		k8sClient = c.Client
+ 	}
+ 	
+ 	// 查询所有节点总数
+ 	totalResult, _, err := k8sClient.Query(ctx, "count(kube_node_status_condition{condition='Ready'})", time.Now())
+ 	if err != nil {
+ 		return nil, fmt.Errorf("查询节点总数失败: %w", err)
+ 	}
+ 	
+ 	// 查询就绪节点数
+ 	readyResult, _, err := k8sClient.Query(ctx, "count(kube_node_status_condition{condition='Ready',status='true'})", time.Now())
+ 	if err != nil {
+ 		return nil, fmt.Errorf("查询就绪节点数失败: %w", err)
+ 	}
+ 	
+ 	nodeHealth := &NodeHealth{}
+ 	
+ 	// 解析结果
+ 	if totalVector, ok := totalResult.(model.Vector); ok && len(totalVector) > 0 {
+ 		nodeHealth.Total = int(totalVector[0].Value)
+ 	}
+ 	
+ 	if readyVector, ok := readyResult.(model.Vector); ok && len(readyVector) > 0 {
+ 		nodeHealth.Ready = int(readyVector[0].Value)
+ 	}
+ 	
+ 	nodeHealth.NotReady = nodeHealth.Total - nodeHealth.Ready
+ 	
+ 	return nodeHealth, nil
+ }
+ 
+ // CollectHarborHealth 收集Harbor健康状态
+ func (c *Collector) CollectHarborHealth() (*HarborHealth, error) {
+ 	// 检查Harbor是否启用
+ 	if !c.config.Harbor.Enabled {
+ 		return nil, nil
+ 	}
+ 	
+ 	// 创建HTTP客户端，支持忽略SSL证书验证
+ 	tr := &http.Transport{
+ 		TLSClientConfig: &tls.Config{InsecureSkipVerify: c.config.Harbor.Insecure},
+ 	}
+ 	client := &http.Client{Transport: tr}
+ 	
+ 	// 构建请求
+ 	req, err := http.NewRequest("GET", fmt.Sprintf("%s/api/v2.0/health", c.config.Harbor.URL), nil)
+ 	if err != nil {
+ 		return nil, fmt.Errorf("创建Harbor健康检查请求失败: %w", err)
+ 	}
+ 	
+ 	// 添加认证
+ 	req.SetBasicAuth(c.config.Harbor.Username, c.config.Harbor.Password)
+ 	
+ 	// 发送请求
+ 	resp, err := client.Do(req)
+ 	if err != nil {
+ 		return nil, fmt.Errorf("访问Harbor健康检查API失败: %w", err)
+ 	}
+ 	defer resp.Body.Close()
+ 	
+ 	// 读取响应
+ 	body, err := ioutil.ReadAll(resp.Body)
+ 	if err != nil {
+ 		return nil, fmt.Errorf("读取Harbor健康检查响应失败: %w", err)
+ 	}
+ 	
+ 	// 解析JSON
+ 	var healthData HarborHealth
+ 	if err := json.Unmarshal(body, &healthData); err != nil {
+ 		return nil, fmt.Errorf("解析Harbor健康检查响应失败: %w", err)
+ 	}
+ 	
+ 	return &healthData, nil
+ }
  
  // CollectMetrics 收集指标数据
```

```diff
  		Project:      c.config.ProjectName,
  	}
+ 	
+ 	// 收集节点健康状态
+ 	nodeHealth, err := c.CollectNodeHealth()
+ 	if err != nil {
+ 		log.Printf("警告: 收集节点健康状态失败: %v", err)
+ 	} else {
+ 		data.NodeHealth = nodeHealth
+ 	}
+ 	
+ 	// 收集Harbor健康状态
+ 	harborHealth, err := c.CollectHarborHealth()
+ 	if err != nil {
+ 		log.Printf("警告: 收集Harbor健康状态失败: %v", err)
+ 	} else {
+ 		data.HarborHealth = harborHealth
+ 	}
  
  	for _, metricType := range c.config.MetricTypes {
```

---

现在需要更新 config 包和 report 包，以支持新增的功能：

---

```diff
  
  type Config struct {
- 	PrometheusURL string       `yaml:"prometheus_url"`
- 	MetricTypes   []MetricType `yaml:"metric_types"`
- 	ProjectName   string       `yaml:"project_name"`
- 	CronSchedule  string       `yaml:"cron_schedule"`
- 	ReportCleanup struct {
+ 	PrometheusURL   string       `yaml:"prometheus_url"`
+ 	PrometheusK8s   string       `yaml:"prometheus-k8s"`
+ 	MetricTypes     []MetricType `yaml:"metric_types"`
+ 	ProjectName     string       `yaml:"project_name"`
+ 	CronSchedule    string       `yaml:"cron_schedule"`
+ 	Harbor          HarborConfig `yaml:"harbor"`
+ 	ReportCleanup   struct {
  		Enabled      bool   `yaml:"enabled"`
  		MaxAge       int    `yaml:"max_age"`
```

```diff
  	Port string `yaml:"port"`
  }
+ 
+ // HarborConfig Harbor仓库配置
+ type HarborConfig struct {
+ 	Enabled  bool   `yaml:"enabled"`
+ 	URL      string `yaml:"url"`
+ 	Username string `yaml:"username"`
+ 	Password string `yaml:"password"`
+ 	Insecure bool   `yaml:"insecure"`
+ }
  
  type MetricType struct {
```

```diff
  	PrometheusURL string            `yaml:"prometheus_url"`
  }
+ 
+ // GetK8sPrometheusURL 获取K8s Prometheus URL
+ func (c *Config) GetK8sPrometheusURL() string {
+ 	if c.PrometheusK8s == "" {
+ 		return ""
+ 	}
+ 	
+ 	// 检查是否包含协议和端口
+ 	if len(c.PrometheusK8s) > 0 && c.PrometheusK8s[0:4] == "http" {
+ 		return c.PrometheusK8s
+ 	}
+ 	
+ 	// 默认使用HTTP协议和13324端口，这是默认的K8s Prometheus端口
+ 	return "http://" + c.PrometheusK8s + ":13324/"
+ }
  
```

---

最后更新report包的ReportData结构：

---

```diff
  	Stats         GroupStats // 替换原来的 Average
  }
+ 
+ // NodeHealth 节点健康状态
+ type NodeHealth struct {
+ 	Total    int // 总节点数
+ 	Ready    int // 就绪节点数
+ 	NotReady int // 未就绪节点数 
+ }
+ 
+ // HarborHealth Harbor健康状态
+ type HarborHealth struct {
+ 	Status     string            // 总体状态
+ 	Components []HarborComponent // 组件状态
+ }
+ 
+ // HarborComponent Harbor组件健康状态
+ type HarborComponent struct {
+ 	Name   string // 组件名称
+ 	Status string // 组件状态
+ }
+ 
  type ReportData struct {
  	Timestamp    time.Time
  	MetricGroups map[string]*MetricGroup
  	ChartData    map[string]template.JS
  	Project      string
+ 	NodeHealth   *NodeHealth   // 节点健康状态
+ 	HarborHealth *HarborHealth // Harbor健康状态
  }
  
```

---

我已经完成了所有必要的修改，现在让我总结一下我所做的更改：

1. 修改了配置文件，添加了Harbor仓库配置：
   - 添加了Harbor相关配置，包括URL、用户名、密码和证书验证设置
   - 默认复用k8s主节点IP地址

2. 修改了report.html模板：
   - 将"Pod运行状态"标题改为"容器化平台健康度"
   - 添加了节点健康情况显示，使用"x/y"格式展示节点就绪状态
   - 添加了Harbor仓库健康状态显示，包括整体状态和各组件状态
   - 使用简洁优雅的UI设计，包括卡片式布局和合适的颜色标识

3. 更新了数据模型和处理逻辑：
   - 添加了NodeHealth和HarborHealth数据结构
   - 实现了收集节点健康状态的功能，使用Prometheus查询
   - 实现了收集Harbor健康状态的功能，通过API调用
   - 将这些数据集成到报告数据结构中

这些修改使巡检报告现在能够:
1. 显示容器化平台健康度作为总览
2. 展示节点健康情况，清晰显示就绪/未就绪节点数
3. 展示Harbor仓库健康状态及其各组件状态
4. 保持原有的Pod运行状态展示，但作为容器化平台健康度的一部分

所有修改保持了简洁优雅的UI风格，确保信息展示清晰易读。

---

_**User**_

 go build -o stellar-autops main.go
# stellar-autops/pkg/metrics
pkg/metrics/collector.go:193:21: cannot use nodeHealth (variable of type *NodeHealth) as *report.NodeHealth value in assignment
pkg/metrics/collector.go:201:23: cannot use harborHealth (variable of type *HarborHealth) as *report.HarborHealth value in assignment


---

_**Assistant**_



---

需要修复 collector.go 中的类型不匹配问题。错误是因为我们在 metrics 包中定义了 NodeHealth 和 HarborHealth 类型，但是在 report 包中也定义了相同的结构体，导致类型不匹配。

让我们修改 collector.go 文件，使用 report 包中的类型来替代本地定义的类型：

---

```diff
  	QueryRange(ctx context.Context, query string, r v1.Range, opts ...v1.Option) (model.Value, v1.Warnings, error)
  }
- 
- // 节点健康状态结构
- type NodeHealth struct {
- 	Total    int
- 	Ready    int
- 	NotReady int
- }
- 
- // Harbor健康状态结构
- type HarborHealth struct {
- 	Status     string
- 	Components []HarborComponent
- }
- 
- type HarborComponent struct {
- 	Name   string
- 	Status string
- }
  
  // NewCollector 创建新的收集器
```

```diff
  
  // CollectNodeHealth 收集节点健康状态
- func (c *Collector) CollectNodeHealth() (*NodeHealth, error) {
+ func (c *Collector) CollectNodeHealth() (*report.NodeHealth, error) {
  	ctx := context.Background()
  	k8sPrometheusURL := c.config.GetK8sPrometheusURL()
```

```diff
  	}
  	
- 	nodeHealth := &NodeHealth{}
+ 	nodeHealth := &report.NodeHealth{}
  	
  	// 解析结果
```

```diff
  
  // CollectHarborHealth 收集Harbor健康状态
- func (c *Collector) CollectHarborHealth() (*HarborHealth, error) {
+ func (c *Collector) CollectHarborHealth() (*report.HarborHealth, error) {
  	// 检查Harbor是否启用
  	if !c.config.Harbor.Enabled {
```

```diff
  	
  	// 解析JSON
- 	var healthData HarborHealth
+ 	var healthData report.HarborHealth
  	if err := json.Unmarshal(body, &healthData); err != nil {
  		return nil, fmt.Errorf("解析Harbor健康检查响应失败: %w", err)
```

---

需要修复模板中的JavaScript错误。linter报告了775行的错误：
```
var data = {{.MetricGroups}};
```
这个JavaScript代码在直接渲染JSON时可能会导致语法错误。我们需要将模板数据正确转换为JSON：

---

```diff
  <script>
      // 将数据作为JavaScript变量嵌入页面
-     var data = {{.MetricGroups}};
+     var data = JSON.parse('{{toJSON .MetricGroups}}');
  
      // 获取system_uptime数据并渲染机器格子图
```

---

我们也需要在模板函数映射中添加 `toJSON` 函数，将数据结构转换为JSON字符串：

---

```diff
  	funcMap := template.FuncMap{
  		"now": time.Now,
+ 		"toJSON": func(v interface{}) string {
+ 			jsonData, err := json.Marshal(v)
+ 			if err != nil {
+ 				return "{}"
+ 			}
+ 			return string(jsonData)
+ 		},
  		"groupPodsByNamespace": func(metrics []MetricData) map[string][]MetricData {
  			return groupPodsByNamespace(metrics)
```

---

现在尝试构建项目：

---

```bash
cd /iflytek/dev/stellar-v2.2-dev/stellar-autops && go build -o stellar-autops main.go
```

```
(gpt) root@iflytek239:/iflytek/dev/stellar-v2.2-dev/stellar-autops# cd /iflytek/dev/stellar-v2.2-dev/stellar-au
(gpt) root@iflytek239:/iflytek/dev/stellar-v2.2-dev/stellar-autops# cd /iflytek/dev/stellar-v2.2-dev/stellar-au
<d /iflytek/dev/stellar-v2.2-dev/stellar-autops && go build -o stellar-autops main.go
(gpt) root@iflytek239:/iflytek/dev/stellar-v2.2-dev/stellar-autops#
```

---

很好，构建成功了。我们已经解决了以下问题：

1. 修复了类型不匹配的问题
   - 删除了 metrics 包中的 `NodeHealth` 和 `HarborHealth` 结构体定义
   - 改用 report 包中已定义的类型
   - 将收集函数的返回类型修改为使用 report 包中的类型

2. 修复了模板中的 JavaScript 错误
   - 添加了 `toJSON` 辅助函数将数据结构安全地转换为 JSON 字符串
   - 修改了模板中的 JavaScript 代码，使用 `JSON.parse` 解析生成的 JSON 字符串

现在这些更改完成后，可以正常构建项目了。Pod 运行状态部分已成功重命名为"容器化平台健康度"，并且添加了节点健康情况和 Harbor 仓库健康状态的显示。

我们所做的修改包括：
1. 在 `config.yaml` 中增加了 Harbor 配置
2. 在 `templates/report.html` 中修改了 UI 显示
3. 在 `pkg/metrics/collector.go` 中添加了数据收集功能
4. 在 `pkg/report/generator.go` 中添加了新的数据结构和辅助函数
5. 修复了构建过程中出现的类型不匹配和模板错误问题

---

_**User**_

2025/05/17 19:31:03 Error generating report: executing template: template: report.html:600:80: executing "report.html" at <.NodeHealth.Ready>: can't evaluate field NodeHealth in type []report.MetricData


---

_**Assistant**_



---

这个错误显示在模板中访问 `.NodeHealth.Ready` 时出现了问题，因为当前上下文是 `[]report.MetricData` 类型，而不是顶层的 `ReportData`。

这个问题出现在模板的循环内部，我们需要使用 `$.` 来引用顶层数据，而不是使用 `.` 来引用当前循环中的数据。让我修复这个问题：

---

```diff
                              <div class="node-health-stats">
                                  <div class="node-health-card">
-                                     <div class="node-health-value">{{.NodeHealth.Ready}}/{{.NodeHealth.Total}}</div>
+                                     <div class="node-health-value">{{$.NodeHealth.Ready}}/{{$.NodeHealth.Total}}</div>
                                      <div class="node-health-label">节点就绪状态</div>
                                  </div>
-                                 {{if gt .NodeHealth.NotReady 0}}
+                                 {{if gt $.NodeHealth.NotReady 0}}
                                  <div class="node-health-warning">
-                                     <span class="critical">有 {{.NodeHealth.NotReady}} 个节点未就绪</span>
+                                     <span class="critical">有 {{$.NodeHealth.NotReady}} 个节点未就绪</span>
                                  </div>
                                  {{end}}
```

```diff
                          
                          <!-- Harbor健康状态 -->
-                         {{if .HarborHealth}}
+                         {{if $.HarborHealth}}
                          <div class="harbor-health-section">
                              <h5>容器镜像仓库</h5>
                              <div class="harbor-health-cards">
-                                 <div class="harbor-health-status {{if eq .HarborHealth.Status "healthy"}}healthy{{else}}unhealthy{{end}}">
-                                     <span class="harbor-status-icon">{{if eq .HarborHealth.Status "healthy"}}✓{{else}}✗{{end}}</span>
-                                     <span>Harbor服务状态: {{.HarborHealth.Status}}</span>
+                                 <div class="harbor-health-status {{if eq $.HarborHealth.Status "healthy"}}healthy{{else}}unhealthy{{end}}">
+                                     <span class="harbor-status-icon">{{if eq $.HarborHealth.Status "healthy"}}✓{{else}}✗{{end}}</span>
+                                     <span>Harbor服务状态: {{$.HarborHealth.Status}}</span>
                                  </div>
                                  
                                  <div class="harbor-components">
-                                     {{range .HarborHealth.Components}}
+                                     {{range $.HarborHealth.Components}}
                                      <div class="harbor-component {{.Status}}">
                                          <span class="component-name">{{.Name}}</span>
```

---

让我们测试一下这些修改是否解决了问题：

---

```bash
cd /iflytek/dev/stellar-v2.2-dev/stellar-autops && go build -o stellar-autops main.go && ./stellar-autops
```

```
(gpt) root@iflytek239:/iflytek/dev/stellar-v2.2-dev/stellar-autops# cd /iflytek/dev/stellar-v2.2-dev/stellar-au
tops && go build -o stellar-autops main.go && ./stellar-autops
2025/05/17 19:32:01 使用配置文件中的 Prometheus URL: http://172.31.101.239:46627/
2025/05/17 19:32:01 已启动定时任务，执行计划: 15 16,17 * * *
2025/05/17 19:32:01 已启动清理定时任务，执行计划: 0 0 * * *
2025/05/17 19:32:01 Starting server on port: 8091 with config: config/config.yaml
2025/05/17 19:32:01 Prometheus URL: http://172.31.101.239:46627/
2025/05/17 19:32:01 获取报告地址: http://localhost:8091/getreport
2025/05/17 19:32:01 健康看板地址: http://localhost:8091/status
2025/05/17 19:32:01 Error starting HTTP server: listen tcp :8091: bind: address already in use
(gpt) root@iflytek239:/iflytek/dev/stellar-v2.2-dev/stellar-autops#
```

---

看起来服务器端口已经被占用，让我们尝试手动生成一个报告来测试我们的修改：

---

<details>
            <summary>Searched codebase "main.go" • **1** results</summary>
        
| File |
|------|
| `undefined` |

</details>

---

Read file: main.go

---

让我们创建一个临时的测试脚本来手动生成报告并测试我们的修改：

---

```diff
- 
+ package main
+ 
+ import (
+ 	"log"
+ 	"os"
+ 	
+ 	"stellar-autops/pkg/config"
+ 	"stellar-autops/pkg/metrics"
+ 	"stellar-autops/pkg/prometheus"
+ 	"stellar-autops/pkg/report"
+ 	
+ 	"gopkg.in/yaml.v2"
+ )
+ 
+ func main() {
+ 	// 加载配置
+ 	configPath := "config/config.yaml"
+ 	data, err := os.ReadFile(configPath)
+ 	if err != nil {
+ 		log.Fatalf("读取配置文件失败: %v", err)
+ 	}
+ 
+ 	var cfg config.Config
+ 	if err := yaml.Unmarshal(data, &cfg); err != nil {
+ 		log.Fatalf("解析配置文件失败: %v", err)
+ 	}
+ 
+ 	// 创建Prometheus客户端
+ 	client, err := prometheus.NewClient(cfg.PrometheusURL)
+ 	if err != nil {
+ 		log.Fatalf("创建Prometheus客户端失败: %v", err)
+ 	}
+ 
+ 	// 创建收集器
+ 	collector := metrics.NewCollector(client.API, &cfg)
+ 
+ 	// 收集指标
+ 	log.Println("开始收集指标...")
+ 	data, err := collector.CollectMetrics()
+ 	if err != nil {
+ 		log.Fatalf("收集指标失败: %v", err)
+ 	}
+ 	
+ 	// 生成报告
+ 	log.Println("开始生成报告...")
+ 	reportPath, err := report.GenerateReport(*data)
+ 	if err != nil {
+ 		log.Fatalf("生成报告失败: %v", err)
+ 	}
+ 	
+ 	log.Printf("报告生成成功: %s", reportPath)
+ } 
```

---

现在让我们运行这个测试脚本：

---

```bash
cd /iflytek/dev/stellar-v2.2-dev/stellar-autops && go run test_report.go
```

```
(gpt) root@iflytek239:/iflytek/dev/stellar-v2.2-dev/stellar-autops# cd /iflytek/dev/stellar-v2.2-dev/stellar-au
tops && go run test_report.go
# command-line-arguments
./test_report.go:39:12: no new variables on left side of :=
./test_report.go:39:15: cannot use collector.CollectMetrics() (value of type *report.ReportData) as []byte valu
e in assignment
./test_report.go:46:44: invalid operation: cannot indirect data (variable of type []byte)
(gpt) root@iflytek239:/iflytek/dev/stellar-v2.2-dev/stellar-autops#
```

---

测试脚本有一些语法错误，让我们修复一下：

---

```diff
  	// 收集指标
  	log.Println("开始收集指标...")
- 	data, err := collector.CollectMetrics()
+ 	reportData, err := collector.CollectMetrics()
  	if err != nil {
  		log.Fatalf("收集指标失败: %v", err)
```

```diff
  	// 生成报告
  	log.Println("开始生成报告...")
- 	reportPath, err := report.GenerateReport(*data)
+ 	reportPath, err := report.GenerateReport(*reportData)
  	if err != nil {
  		log.Fatalf("生成报告失败: %v", err)
```

---

让我们再次运行测试脚本：

---

```bash
cd /iflytek/dev/stellar-v2.2-dev/stellar-autops && go run test_report.go
```

```
(gpt) root@iflytek239:/iflytek/dev/stellar-v2.2-dev/stellar-autops# cd /iflytek/dev/stellar-v2.2-dev/stellar-au
tops && go run test_report.go
2025/05/17 19:33:07 开始收集指标...
2025/05/17 19:33:08 指标 [CPU使用率] 查询结果: {ident="241-ftp"} => 0.11667637776794577 @[1747481588.664]
{ident="devops-app-169"} => 4.9781732764566655 @[1747481588.664]
{ident="iflytek238"} => 0.028704234794583807 @[1747481588.664]
{ident="iflytek239"} => 13.545983070250788 @[1747481588.664]
{ident="server176"} => 2.224090201203561 @[1747481588.664]
{ident="zjma6"} => 58.346354166666664 @[1747481588.664]
2025/05/17 19:33:08 指标 [CPU使用率] 原始数据: {ident="241-ftp"}, 值: 0.11667637776794577
2025/05/17 19:33:08 指标 [CPU使用率] 原始数据: {ident="devops-app-169"}, 值: 4.9781732764566655
2025/05/17 19:33:08 指标 [CPU使用率] 原始数据: {ident="iflytek238"}, 值: 0.028704234794583807
2025/05/17 19:33:08 指标 [CPU使用率] 原始数据: {ident="iflytek239"}, 值: 13.545983070250788
2025/05/17 19:33:08 指标 [CPU使用率] 原始数据: {ident="server176"}, 值: 2.224090201203561
2025/05/17 19:33:08 指标 [CPU使用率] 原始数据: {ident="zjma6"}, 值: 58.346354166666664
2025/05/17 19:33:08 指标 [内存使用率] 查询结果: {ident="241-ftp"} => 10.302525627898383 @[1747481588.68]
{ident="devops-app-169"} => 26.518773207665763 @[1747481588.68]
{ident="iflytek238"} => 3.6610900658372287 @[1747481588.68]
{ident="iflytek239"} => 39.57367449181635 @[1747481588.68]
{ident="server176"} => 15.987090239620324 @[1747481588.68]
{ident="zjma6"} => 82.03321763353111 @[1747481588.68]
2025/05/17 19:33:08 指标 [内存使用率] 原始数据: {ident="241-ftp"}, 值: 10.302525627898383
2025/05/17 19:33:08 指标 [内存使用率] 原始数据: {ident="devops-app-169"}, 值: 26.518773207665763
2025/05/17 19:33:08 指标 [内存使用率] 原始数据: {ident="iflytek238"}, 值: 3.6610900658372287
2025/05/17 19:33:08 指标 [内存使用率] 原始数据: {ident="iflytek239"}, 值: 39.57367449181635
2025/05/17 19:33:08 指标 [内存使用率] 原始数据: {ident="server176"}, 值: 15.987090239620324
2025/05/17 19:33:08 指标 [内存使用率] 原始数据: {ident="zjma6"}, 值: 82.03321763353111
2025/05/17 19:33:08 指标 [系统运行时间] 查询结果: system_uptime{ident="241-ftp"} => 66961224 @[1747481588.681]
system_uptime{ident="devops-app-169"} => 23940103 @[1747481588.681]
system_uptime{ident="iflytek238"} => 764869 @[1747481588.681]
system_uptime{ident="iflytek239", source="categraf"} => 804714 @[1747481588.681]
system_uptime{ident="server176"} => 2081060 @[1747481588.681]
system_uptime{ident="zjma6"} => 873615 @[1747481588.681]
2025/05/17 19:33:08 指标 [系统运行时间] 原始数据: system_uptime{ident="241-ftp"}, 值: 66961224
2025/05/17 19:33:08 指标 [系统运行时间] 原始数据: system_uptime{ident="devops-app-169"}, 值: 23940103
2025/05/17 19:33:08 指标 [系统运行时间] 原始数据: system_uptime{ident="iflytek238"}, 值: 764869
2025/05/17 19:33:08 指标 [系统运行时间] 原始数据: system_uptime{ident="iflytek239", source="categraf"}, 值: 804
714
2025/05/17 19:33:08 指标 [系统运行时间] 原始数据: system_uptime{ident="server176"}, 值: 2081060
2025/05/17 19:33:08 指标 [系统运行时间] 原始数据: system_uptime{ident="zjma6"}, 值: 873615
2025/05/17 19:33:08 指标 [根分区磁盘使用率] 查询结果: {device="dm-0", ident="241-ftp", path="/"} => 80.15643643
480996 @[1747481588.682]
{device="sda3", ident="iflytek238", path="/"} => 7.297224370039815 @[1747481588.682]
{device="sda3", ident="iflytek239", path="/"} => 66.53469363872419 @[1747481588.682]
{device="sda3", ident="devops-app-169", path="/"} => 99.99997714607602 @[1747481588.682]
{device="sda3", ident="server176", path="/"} => 26.62684156024347 @[1747481588.682]
2025/05/17 19:33:08 指标 [根分区磁盘使用率] 原始数据: {device="dm-0", ident="241-ftp", path="/"}, 值: 80.156436
43480996
2025/05/17 19:33:08 指标 [根分区磁盘使用率] 原始数据: {device="sda3", ident="iflytek238", path="/"}, 值: 7.2972
24370039815
2025/05/17 19:33:08 指标 [根分区磁盘使用率] 原始数据: {device="sda3", ident="iflytek239", path="/"}, 值: 66.534
69363872419
2025/05/17 19:33:08 指标 [根分区磁盘使用率] 原始数据: {device="sda3", ident="devops-app-169", path="/"}, 值: 99
.99997714607602
2025/05/17 19:33:08 指标 [根分区磁盘使用率] 原始数据: {device="sda3", ident="server176", path="/"}, 值: 26.6268
4156024347
2025/05/17 19:33:08 指标 [/iflytek分区磁盘使用率] 查询结果: {device="sdb", ident="iflytek238", path="/iflytek"}
 => 5.592675834344969 @[1747481588.684]
{device="sdb1", ident="iflytek239", path="/iflytek"} => 19.9008480243353 @[1747481588.684]
2025/05/17 19:33:08 指标 [/iflytek分区磁盘使用率] 原始数据: {device="sdb", ident="iflytek238", path="/iflytek"}
, 值: 5.592675834344969
2025/05/17 19:33:08 指标 [/iflytek分区磁盘使用率] 原始数据: {device="sdb1", ident="iflytek239", path="/iflytek"
}, 值: 19.9008480243353
2025/05/17 19:33:08 指标 [Pod运行状态] 查询结果: {namespace="argocd", phase="Running", pod="devops-argocd-appli
cation-controller-0"} => 1 @[1747481588.685]
{namespace="argocd", phase="Running", pod="devops-argocd-applicationset-controller-86959cfd77-gxfkw"} => 1 @[17
47481588.685]
{namespace="argocd", phase="Running", pod="devops-argocd-dex-server-6cd7d6fbbb-x8rlf"} => 1 @[1747481588.685]
{namespace="argocd", phase="Running", pod="devops-argocd-notifications-controller-6f7dcdc57f-kbz8p"} => 1 @[174
7481588.685]
{namespace="argocd", phase="Running", pod="devops-argocd-redis-855b65f5c4-x9lsx"} => 1 @[1747481588.685]
{namespace="argocd", phase="Running", pod="devops-argocd-repo-server-594cb5bd6d-z5x42"} => 1 @[1747481588.685]
{namespace="argocd", phase="Running", pod="devops-argocd-server-5b58bd774c-ts2xr"} => 1 @[1747481588.685]
{namespace="default", phase="Running", pod="traefik-b975d5bf6-b4hrx"} => 1 @[1747481588.685]
{namespace="default", phase="Running", pod="whoami-5f6cf49755-6n9tq"} => 1 @[1747481588.685]
{namespace="kibana", phase="Running", pod="fluent-fluent-bit-wmwhh"} => 1 @[1747481588.685]
{namespace="kube-system", phase="Pending", pod="snapshot-controller-0"} => 1 @[1747481588.685]
{namespace="kube-system", phase="Running", pod="calico-kube-controllers-6f996c8485-lsfxf"} => 1 @[1747481588.68
5]
{namespace="kube-system", phase="Running", pod="calico-node-4zqjg"} => 1 @[1747481588.685]
{namespace="kube-system", phase="Running", pod="coredns-6f7684f6c9-dgvsn"} => 1 @[1747481588.685]
{namespace="kube-system", phase="Running", pod="coredns-6f7684f6c9-r9rn8"} => 1 @[1747481588.685]
{namespace="kube-system", phase="Running", pod="kube-apiserver-iflytek239"} => 1 @[1747481588.685]
{namespace="kube-system", phase="Running", pod="kube-controller-manager-iflytek239"} => 1 @[1747481588.685]
{namespace="kube-system", phase="Running", pod="kube-proxy-r8f9p"} => 1 @[1747481588.685]
{namespace="kube-system", phase="Running", pod="kube-scheduler-iflytek239"} => 1 @[1747481588.685]
{namespace="kube-system", phase="Running", pod="nodelocaldns-ltk27"} => 1 @[1747481588.685]
{namespace="kube-system", phase="Running", pod="openebs-localpv-provisioner-7bf67bc995-r764z"} => 1 @[174748158
8.685]
{namespace="kubesphere-controls-system", phase="Pending", pod="default-http-backend-64599cfd89-5npp9"} => 1 @[1
747481588.685]
{namespace="kubesphere-controls-system", phase="Running", pod="default-http-backend-696d6bf54f-cm8vr"} => 1 @[1
747481588.685]
{namespace="kubesphere-controls-system", phase="Running", pod="kubectl-admin-b49cf5585-6vw42"} => 1 @[174748158
8.685]
{namespace="kubesphere-devops-system", phase="Pending", pod="devops-28909950-gjv57"} => 1 @[1747481588.685]
{namespace="kubesphere-devops-system", phase="Running", pod="devops-apiserver-869c476b69-bxzhx"} => 1 @[1747481
588.685]
{namespace="kubesphere-devops-system", phase="Running", pod="devops-controller-5df497599b-wbhfd"} => 1 @[174748
1588.685]
{namespace="kubesphere-devops-system", phase="Running", pod="devops-jenkins-8585597845-ms76m"} => 1 @[174748158
8.685]
{namespace="kubesphere-devops-system", phase="Running", pod="s2ioperator-0"} => 1 @[1747481588.685]
{namespace="kubesphere-devops-system", phase="Succeeded", pod="devops-28909560-hzjsn"} => 1 @[1747481588.685]
{namespace="kubesphere-devops-system", phase="Succeeded", pod="devops-28909590-s42rh"} => 1 @[1747481588.685]
{namespace="kubesphere-devops-system", phase="Succeeded", pod="devops-28909620-zwwjn"} => 1 @[1747481588.685]
{namespace="kubesphere-monitoring-system", phase="Running", pod="alertmanager-main-0"} => 1 @[1747481588.685]
{namespace="kubesphere-monitoring-system", phase="Running", pod="kube-state-metrics-774ff789cf-zdz8p"} => 1 @[1
747481588.685]
{namespace="kubesphere-monitoring-system", phase="Running", pod="node-exporter-f4g58"} => 1 @[1747481588.685]
{namespace="kubesphere-monitoring-system", phase="Running", pod="notification-manager-deployment-78ff4d6789-wfn
vm"} => 1 @[1747481588.685]
{namespace="kubesphere-monitoring-system", phase="Running", pod="notification-manager-operator-85d67fdc46-mmzkg
"} => 1 @[1747481588.685]
{namespace="kubesphere-monitoring-system", phase="Running", pod="prometheus-k8s-0"} => 1 @[1747481588.685]
{namespace="kubesphere-monitoring-system", phase="Running", pod="prometheus-operator-57c78bd7fb-vq4q4"} => 1 @[
1747481588.685]
{namespace="kubesphere-system", phase="Running", pod="ks-apiserver-88cf58d58-ppplz"} => 1 @[1747481588.685]
{namespace="kubesphere-system", phase="Running", pod="ks-console-54ddb79bf9-78twl"} => 1 @[1747481588.685]
{namespace="kubesphere-system", phase="Running", pod="ks-controller-manager-78b895956d-n6ph2"} => 1 @[174748158
8.685]
{namespace="kubesphere-system", phase="Running", pod="ks-installer-67946fcc5f-9tdh4"} => 1 @[1747481588.685]
{namespace="kubesphere-system", phase="Running", pod="minio-7879c5dd65-7tjrh"} => 1 @[1747481588.685]
{namespace="kubesphere-system", phase="Running", pod="openldap-0"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Pending", pod="mysql-0"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Pending", pod="nacos-0"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Pending", pod="nacos-1"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Pending", pod="nacos-2"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Running", pod="kafka-0"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Running", pod="kafka-1"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Running", pod="kafka-2"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Running", pod="kafka-exporter-9b6c4ff76-46wc5"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Running", pod="redis-master-0"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Running", pod="redis-replicas-0"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Running", pod="zookeeper-0"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Running", pod="zookeeper-1"} => 1 @[1747481588.685]
{namespace="kxdigit", phase="Running", pod="zookeeper-2"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Pending", pod="grafana-6d47965b6f-7cxv8"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="eck-stack-eck-kibana-kb-555d4fb9b7-z62d9"} => 1 @[174748
1588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="elastic-operator-0"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="elasticsearch-es-default-0"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="es239-prometheus-elasticsearch-exporter-754c7fb948-d2crp
"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="loki-0"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="loki-promtail-t259f"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="stellar-autops-57dc9b8cb6-mcxm5"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="stellar-categraf-g2dc5"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="stellar-center-c847d4b65-6fb5d"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="stellar-database-0"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="stellar-nginx-6bb8c4d44d-s95pv"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="stellar-prometheus-0"} => 1 @[1747481588.685]
{namespace="kxdigit-monitoring", phase="Running", pod="stellar-redis-0"} => 1 @[1747481588.685]
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="argocd", phase="Running", pod="devops-argocd-appli
cation-controller-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="argocd", phase="Running", pod="devops-argocd-appli
cationset-controller-86959cfd77-gxfkw"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="argocd", phase="Running", pod="devops-argocd-dex-s
erver-6cd7d6fbbb-x8rlf"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="argocd", phase="Running", pod="devops-argocd-notif
ications-controller-6f7dcdc57f-kbz8p"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="argocd", phase="Running", pod="devops-argocd-redis
-855b65f5c4-x9lsx"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="argocd", phase="Running", pod="devops-argocd-repo-
server-594cb5bd6d-z5x42"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="argocd", phase="Running", pod="devops-argocd-serve
r-5b58bd774c-ts2xr"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="default", phase="Running", pod="traefik-b975d5bf6-
b4hrx"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="default", phase="Running", pod="whoami-5f6cf49755-
6n9tq"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kibana", phase="Running", pod="fluent-fluent-bit-w
mwhh"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Pending", pod="snapshot-contr
oller-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Running", pod="calico-kube-co
ntrollers-6f996c8485-lsfxf"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Running", pod="calico-node-4z
qjg"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Running", pod="coredns-6f7684
f6c9-dgvsn"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Running", pod="coredns-6f7684
f6c9-r9rn8"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Running", pod="kube-apiserver
-iflytek239"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Running", pod="kube-controlle
r-manager-iflytek239"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Running", pod="kube-proxy-r8f
9p"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Running", pod="kube-scheduler
-iflytek239"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Running", pod="nodelocaldns-l
tk27"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kube-system", phase="Running", pod="openebs-localp
v-provisioner-7bf67bc995-r764z"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-controls-system", phase="Pending", pod=
"default-http-backend-64599cfd89-5npp9"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-controls-system", phase="Running", pod=
"default-http-backend-696d6bf54f-cm8vr"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-controls-system", phase="Running", pod=
"kubectl-admin-b49cf5585-6vw42"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-devops-system", phase="Pending", pod="d
evops-28909950-gjv57"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-devops-system", phase="Running", pod="d
evops-apiserver-869c476b69-bxzhx"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-devops-system", phase="Running", pod="d
evops-controller-5df497599b-wbhfd"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-devops-system", phase="Running", pod="d
evops-jenkins-8585597845-ms76m"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-devops-system", phase="Running", pod="s
2ioperator-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-devops-system", phase="Succeeded", pod=
"devops-28909560-hzjsn"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-devops-system", phase="Succeeded", pod=
"devops-28909590-s42rh"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-devops-system", phase="Succeeded", pod=
"devops-28909620-zwwjn"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-monitoring-system", phase="Running", po
d="alertmanager-main-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-monitoring-system", phase="Running", po
d="kube-state-metrics-774ff789cf-zdz8p"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-monitoring-system", phase="Running", po
d="node-exporter-f4g58"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-monitoring-system", phase="Running", po
d="notification-manager-deployment-78ff4d6789-wfnvm"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-monitoring-system", phase="Running", po
d="notification-manager-operator-85d67fdc46-mmzkg"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-monitoring-system", phase="Running", po
d="prometheus-k8s-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-monitoring-system", phase="Running", po
d="prometheus-operator-57c78bd7fb-vq4q4"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-system", phase="Running", pod="ks-apise
rver-88cf58d58-ppplz"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-system", phase="Running", pod="ks-conso
le-54ddb79bf9-78twl"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-system", phase="Running", pod="ks-contr
oller-manager-78b895956d-n6ph2"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-system", phase="Running", pod="ks-insta
ller-67946fcc5f-9tdh4"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-system", phase="Running", pod="minio-78
79c5dd65-7tjrh"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kubesphere-system", phase="Running", pod="openldap
-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Pending", pod="mysql-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Pending", pod="nacos-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Pending", pod="nacos-1"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Pending", pod="nacos-2"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Running", pod="kafka-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Running", pod="kafka-1"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Running", pod="kafka-2"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Running", pod="kafka-exporter-9b6
c4ff76-46wc5"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Running", pod="redis-master-0"}, 
值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Running", pod="redis-replicas-0"}
, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Running", pod="zookeeper-0"}, 值:
 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Running", pod="zookeeper-1"}, 值:
 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit", phase="Running", pod="zookeeper-2"}, 值:
 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Pending", pod="grafana
-6d47965b6f-7cxv8"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="eck-sta
ck-eck-kibana-kb-555d4fb9b7-z62d9"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="elastic
-operator-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="elastic
search-es-default-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="es239-p
rometheus-elasticsearch-exporter-754c7fb948-d2crp"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="loki-0"
}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="loki-pr
omtail-t259f"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="stellar
-autops-57dc9b8cb6-mcxm5"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="stellar
-categraf-g2dc5"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="stellar
-center-c847d4b65-6fb5d"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="stellar
-database-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="stellar
-nginx-6bb8c4d44d-s95pv"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="stellar
-prometheus-0"}, 值: 1
2025/05/17 19:33:08 指标 [Pod运行状态] 原始数据: {namespace="kxdigit-monitoring", phase="Running", pod="stellar
-redis-0"}, 值: 1
2025/05/17 19:33:08 指标 [节点就绪状态] 查询结果: kube_node_status_condition{condition="Ready", instance="10.23
3.109.73:8443", job="kube-state-metrics", node="iflytek239", status="false"} => 0 @[1747481588.691]
kube_node_status_condition{condition="Ready", instance="10.233.109.73:8443", job="kube-state-metrics", node="if
lytek239", status="unknown"} => 0 @[1747481588.691]
2025/05/17 19:33:08 指标 [节点就绪状态] 原始数据: kube_node_status_condition{condition="Ready", instance="10.23
3.109.73:8443", job="kube-state-metrics", node="iflytek239", status="false"}, 值: 0
2025/05/17 19:33:08 指标 [节点就绪状态] 原始数据: kube_node_status_condition{condition="Ready", instance="10.23
3.109.73:8443", job="kube-state-metrics", node="iflytek239", status="unknown"}, 值: 0
2025/05/17 19:33:08 开始生成报告...
2025/05/17 19:33:08 标签值： sdb1 指标值： 0
2025/05/17 19:33:08 标签值： iflytek238 指标值： 0
2025/05/17 19:33:08 标签值： /iflytek 指标值： 0
2025/05/17 19:33:08 标签值： sdb 指标值： 0
2025/05/17 19:33:08 标签值： iflytek239 指标值： 0
2025/05/17 19:33:08 标签值： fluent-fluent-bit-wmwhh 指标值： 0
2025/05/17 19:33:08 标签值： stellar-nginx-6bb8c4d44d-s95pv 指标值： 0
2025/05/17 19:33:08 标签值： devops-argocd-server-5b58bd774c-ts2xr 指标值： 0
2025/05/17 19:33:08 标签值： kube-apiserver-iflytek239 指标值： 0
2025/05/17 19:33:08 标签值： openebs-localpv-provisioner-7bf67bc995-r764z 指标值： 0
2025/05/17 19:33:08 标签值： kubectl-admin-b49cf5585-6vw42 指标值： 0
2025/05/17 19:33:08 标签值： devops-28909950-gjv57 指标值： 0
2025/05/17 19:33:08 标签值： node-exporter-f4g58 指标值： 0
2025/05/17 19:33:08 标签值： ks-installer-67946fcc5f-9tdh4 指标值： 0
2025/05/17 19:33:08 标签值： kafka-0 指标值： 0
2025/05/17 19:33:08 标签值： zookeeper-2 指标值： 0
2025/05/17 19:33:08 标签值： traefik-b975d5bf6-b4hrx 指标值： 0
2025/05/17 19:33:08 标签值： devops-28909560-hzjsn 指标值： 0
2025/05/17 19:33:08 标签值： whoami-5f6cf49755-6n9tq 指标值： 0
2025/05/17 19:33:08 标签值： devops-controller-5df497599b-wbhfd 指标值： 0
2025/05/17 19:33:08 标签值： ks-controller-manager-78b895956d-n6ph2 指标值： 0
2025/05/17 19:33:08 标签值： minio-7879c5dd65-7tjrh 指标值： 0
2025/05/17 19:33:08 标签值： nacos-2 指标值： 0
2025/05/17 19:33:08 标签值： devops-argocd-repo-server-594cb5bd6d-z5x42 指标值： 0
2025/05/17 19:33:08 标签值： default 指标值： 0
2025/05/17 19:33:08 标签值： kube-scheduler-iflytek239 指标值： 0
2025/05/17 19:33:08 标签值： kafka-1 指标值： 0
2025/05/17 19:33:08 标签值： stellar-database-0 指标值： 0
2025/05/17 19:33:08 标签值： snapshot-controller-0 指标值： 0
2025/05/17 19:33:08 标签值： calico-kube-controllers-6f996c8485-lsfxf 指标值： 0
2025/05/17 19:33:08 标签值： kube-state-metrics-774ff789cf-zdz8p 指标值： 0
2025/05/17 19:33:08 标签值： prometheus-operator-57c78bd7fb-vq4q4 指标值： 0
2025/05/17 19:33:08 标签值： redis-replicas-0 指标值： 0
2025/05/17 19:33:08 标签值： elasticsearch-es-default-0 指标值： 0
2025/05/17 19:33:08 标签值： devops-argocd-redis-855b65f5c4-x9lsx 指标值： 0
2025/05/17 19:33:08 标签值： coredns-6f7684f6c9-dgvsn 指标值： 0
2025/05/17 19:33:08 标签值： devops-jenkins-8585597845-ms76m 指标值： 0
2025/05/17 19:33:08 标签值： openldap-0 指标值： 0
2025/05/17 19:33:08 标签值： nacos-1 指标值： 0
2025/05/17 19:33:08 标签值： loki-0 指标值： 0
2025/05/17 19:33:08 标签值： Pending 指标值： 0
2025/05/17 19:33:08 标签值： nodelocaldns-ltk27 指标值： 0
2025/05/17 19:33:08 标签值： kubesphere-monitoring-system 指标值： 0
2025/05/17 19:33:08 标签值： coredns-6f7684f6c9-r9rn8 指标值： 0
2025/05/17 19:33:08 标签值： kube-proxy-r8f9p 指标值： 0
2025/05/17 19:33:08 标签值： kubesphere-controls-system 指标值： 0
2025/05/17 19:33:08 标签值： kubesphere-devops-system 指标值： 0
2025/05/17 19:33:08 标签值： ks-apiserver-88cf58d58-ppplz 指标值： 0
2025/05/17 19:33:08 标签值： kxdigit 指标值： 0
2025/05/17 19:33:08 标签值： elastic-operator-0 指标值： 0
2025/05/17 19:33:08 标签值： stellar-categraf-g2dc5 指标值： 0
2025/05/17 19:33:08 标签值： stellar-redis-0 指标值： 0
2025/05/17 19:33:08 标签值： devops-argocd-application-controller-0 指标值： 0
2025/05/17 19:33:08 标签值： devops-argocd-applicationset-controller-86959cfd77-gxfkw 指标值： 0
2025/05/17 19:33:08 标签值： devops-argocd-dex-server-6cd7d6fbbb-x8rlf 指标值： 0
2025/05/17 19:33:08 标签值： prometheus-k8s-0 指标值： 0
2025/05/17 19:33:08 标签值： kubesphere-system 指标值： 0
2025/05/17 19:33:08 标签值： stellar-autops-57dc9b8cb6-mcxm5 指标值： 0
2025/05/17 19:33:08 标签值： kube-system 指标值： 0
2025/05/17 19:33:08 标签值： calico-node-4zqjg 指标值： 0
2025/05/17 19:33:08 标签值： default-http-backend-696d6bf54f-cm8vr 指标值： 0
2025/05/17 19:33:08 标签值： devops-apiserver-869c476b69-bxzhx 指标值： 0
2025/05/17 19:33:08 标签值： redis-master-0 指标值： 0
2025/05/17 19:33:08 标签值： zookeeper-0 指标值： 0
2025/05/17 19:33:08 标签值： kxdigit-monitoring 指标值： 0
2025/05/17 19:33:08 标签值： es239-prometheus-elasticsearch-exporter-754c7fb948-d2crp 指标值： 0
2025/05/17 19:33:08 标签值： Running 指标值： 0
2025/05/17 19:33:08 标签值： devops-28909590-s42rh 指标值： 0
2025/05/17 19:33:08 标签值： notification-manager-deployment-78ff4d6789-wfnvm 指标值： 0
2025/05/17 19:33:08 标签值： mysql-0 指标值： 0
2025/05/17 19:33:08 标签值： loki-promtail-t259f 指标值： 0
2025/05/17 19:33:08 标签值： argocd 指标值： 0
2025/05/17 19:33:08 标签值： default-http-backend-64599cfd89-5npp9 指标值： 0
2025/05/17 19:33:08 标签值： Succeeded 指标值： 0
2025/05/17 19:33:08 标签值： devops-28909620-zwwjn 指标值： 0
2025/05/17 19:33:08 标签值： ks-console-54ddb79bf9-78twl 指标值： 0
2025/05/17 19:33:08 标签值： eck-stack-eck-kibana-kb-555d4fb9b7-z62d9 指标值： 0
2025/05/17 19:33:08 标签值： kibana 指标值： 0
2025/05/17 19:33:08 标签值： notification-manager-operator-85d67fdc46-mmzkg 指标值： 0
2025/05/17 19:33:08 标签值： kafka-2 指标值： 0
2025/05/17 19:33:08 标签值： kafka-exporter-9b6c4ff76-46wc5 指标值： 0
2025/05/17 19:33:08 标签值： grafana-6d47965b6f-7cxv8 指标值： 0
2025/05/17 19:33:08 标签值： kube-controller-manager-iflytek239 指标值： 0
2025/05/17 19:33:08 标签值： s2ioperator-0 指标值： 0
2025/05/17 19:33:08 标签值： alertmanager-main-0 指标值： 0
2025/05/17 19:33:08 标签值： nacos-0 指标值： 0
2025/05/17 19:33:08 标签值： stellar-prometheus-0 指标值： 0
2025/05/17 19:33:08 标签值： devops-argocd-notifications-controller-6f7dcdc57f-kbz8p 指标值： 0
2025/05/17 19:33:08 标签值： zookeeper-1 指标值： 0
2025/05/17 19:33:08 标签值： stellar-center-c847d4b65-6fb5d 指标值： 0
2025/05/17 19:33:08 标签值： Ready 指标值： 0
2025/05/17 19:33:08 标签值： iflytek239 指标值： 0
2025/05/17 19:33:08 标签值： devops-app-169 指标值： 0
2025/05/17 19:33:08 标签值： iflytek238 指标值： 0
2025/05/17 19:33:08 标签值： iflytek239 指标值： 0
2025/05/17 19:33:08 标签值： server176 指标值： 0
2025/05/17 19:33:08 标签值： zjma6 指标值： 0
2025/05/17 19:33:08 标签值： 241-ftp 指标值： 0
2025/05/17 19:33:08 标签值： 241-ftp 指标值： 0
2025/05/17 19:33:08 标签值： devops-app-169 指标值： 0
2025/05/17 19:33:08 标签值： iflytek238 指标值： 0
2025/05/17 19:33:08 标签值： iflytek239 指标值： 0
2025/05/17 19:33:08 标签值： server176 指标值： 0
2025/05/17 19:33:08 标签值： zjma6 指标值： 0
2025/05/17 19:33:08 标签值： iflytek238 指标值： 0
2025/05/17 19:33:08 标签值： iflytek239 指标值： 0
2025/05/17 19:33:08 标签值： server176 指标值： 0
2025/05/17 19:33:08 标签值： zjma6 指标值： 0
2025/05/17 19:33:08 标签值： 241-ftp 指标值： 0
2025/05/17 19:33:08 标签值： devops-app-169 指标值： 0
2025/05/17 19:33:08 标签值： devops-app-169 指标值： 0
2025/05/17 19:33:08 标签值： server176 指标值： 0
2025/05/17 19:33:08 标签值： / 指标值： 0
2025/05/17 19:33:08 标签值： dm-0 指标值： 0
2025/05/17 19:33:08 标签值： 241-ftp 指标值： 0
2025/05/17 19:33:08 标签值： sda3 指标值： 0
2025/05/17 19:33:08 标签值： iflytek238 指标值： 0
2025/05/17 19:33:08 标签值： iflytek239 指标值： 0
2025/05/17 19:33:08 项目[星相运维平台巡检报告]报告生成成功: reports/inspection_report_20250517_193308.html
2025/05/17 19:33:08 报告生成成功: reports/inspection_report_20250517_193308.html
(gpt) root@iflytek239:/iflytek/dev/stellar-v2.2-dev/stellar-autops#
```

---

_**User**_

注意离线节点数为status!="true"condition="Ready", status!="true“，然后总结点数为在线condition='Ready'加上这个，现在页面显示1/3是错的

---

_**Assistant**_



---

